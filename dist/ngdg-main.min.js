(()=>{"use strict";var e,t={481:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BumpMapper=void 0;var i=s(212),r=s(224),n=s(787);t.BumpMapper={applyBumpmap:function(e,t,s,a,o){var h=(0,r.computeVertexNormals)(e,t),l=new i.Geometry;l.vertices=h.map((function(e){var t=e.end.clone();return n.GeometryGenerationHelpers.normalizeVectorXYZ(e.start,t,o.bumpmapStrength),t}));var c=new i.Points(l,new i.PointsMaterial({size:1.4,color:65535})),u=null;if(console.log("options.useBumpmap",o.useBumpmap,"bumpmap",s),o.useBumpmap&&s){for(var d=0;d<e.vertexMatrix.length;d++)for(var f=0;f<e.vertexMatrix[d].length;f++){var g=e.vertexMatrix[d][f],v=e.vertices[g],p=1-d/(e.vertexMatrix.length-1),m=f/(e.vertexMatrix[d].length-1),y=s.getHeightAt(m,p),x=l.vertices[g];v.lerp(x,y)}(t=(new i.BufferGeometry).fromGeometry(e)).computeVertexNormals(),u=new i.Mesh(t,a)}return{dildoMesh:u,dildoNormalsMesh:c}}}},615:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DildoGeneration=void 0;var i=s(212),r=s(718),n=s(938),a=s(498),o=s(787),h=s(752),l=s(41),c=s(541),u=s(507),d=s(481),f=function(){function e(e,t){this.canvas=document.getElementById(e),this.parent=this.canvas.parentElement,this.scene=new i.Scene,this.camera=new i.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e4),this.camera.position.z=500;this.ambientLightA=new i.AmbientLight(4473924),this.ambientLightA.position.set(350,0,-350).multiplyScalar(50),this.scene.add(this.ambientLightA),this.ambientLightB=new i.PointLight(16777215,5,3500,.5),this.ambientLightB.position.set(-350,0,350).multiplyScalar(10),this.scene.add(this.ambientLightB),this.directionalLightA=new i.DirectionalLight(16777215,2),this.directionalLightA.position.set(350,350,350).multiplyScalar(10),this.scene.add(this.directionalLightA),this.scene.add(this.directionalLightA.target),this.directionalLightB=new i.DirectionalLight(16777215,2),this.directionalLightB.position.set(-350,-350,-50).multiplyScalar(10),this.scene.add(this.directionalLightB),this.renderer=new i.WebGLRenderer({canvas:this.canvas,preserveDrawingBuffer:!0,antialias:!0}),this.controls=t.makeOrbitControls(this.camera,this.renderer.domElement),this.controls.update(),this.geometries=[],this.partialResults={};var s=this;window.addEventListener("resize",(function(){s.resizeCanvas()})),this.resizeCanvas();var r=function(){requestAnimationFrame(r),s.controls.update(),s.renderer.render(s.scene,s.camera)};r()}return e.prototype.resizeCanvas=function(){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;this.canvas.width=e,this.canvas.height=t,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.canvas.setAttribute("width",e+"px"),this.canvas.setAttribute("height",t+"px"),this.renderer.setSize(e,t),this.camera.setViewOffset(e,t,e/4,t/20,e,t)},e.prototype.rebuild=function(e){this.removeCachedGeometries();var t=e.outline.getBounds().width,s=o.GeometryGenerationHelpers.mkCircularPolygon(t,e.shapeSegmentCount,e.baseShapeExcentricity),h=void 0!==e.useBumpmap&&e.useBumpmap&&e.bumpmap?e.bumpmap:null,l=new n.DildoGeometry(Object.assign({baseShape:s},e)),c=e.useTextureImage&&void 0!==e.textureImagePath,u=void 0!==e.textureImagePath?e.textureImagePath:null,f="double"===e.renderFaces?i.DoubleSide:"back"===e.renderFaces?i.BackSide:i.FrontSide,g=void 0!==e.wireframe&&e.wireframe,v=a.DildoMaterials.createMainMaterial(c,g,u,f),p=(new i.BufferGeometry).fromGeometry(l);p.computeVertexNormals();var m=new i.Mesh(p,v);this.camera.lookAt(new i.Vector3(20,0,150)),this.camera.lookAt(m.position);var y=new i.Geometry;if(l.spineVertices.forEach((function(e){y.vertices.push(e.clone())})),e.addSpine&&o.GeometryGenerationHelpers.addSpine(this,y),e.showBasicPerpendiculars&&o.GeometryGenerationHelpers.addPerpendicularPaths(this,l),e.useBumpmap){var x=d.BumpMapper.applyBumpmap(l,p,h,v,e),b=x.dildoMesh,w=x.dildoNormalsMesh;m=b,e.showBumpmapTargets&&(w.position.y=-100,this.addMesh(w))}if(e.performSlice)this.__performPlaneSlice(m,l,g,c,u,e);else if(m.position.y=-100,m.userData.isExportable=!0,this.addMesh(m),e.showNormals){var C=new r.VertexNormalsHelper(m,e.normalsLength,65280);this.scene.add(C),this.geometries.push(C)}},e.prototype.__performPlaneSlice=function(e,t,s,n,d,f){var g=new i.Plane(new i.Vector3(0,0,1),0),v=o.GeometryGenerationHelpers.makeSlice(t,g),p=new i.Plane(new i.Vector3(0,0,-1),0),m=o.GeometryGenerationHelpers.makeSlice(t,p),y=a.DildoMaterials.createSliceMaterial(n,s,d),x=new i.PlaneGeometry(300,500),b=new i.Mesh(x,new i.MeshBasicMaterial({color:4737096,transparent:!0,opacity:.35,side:i.DoubleSide}));b.rotation.x=Math.PI/5,this.partialResults[u.KEY_SPLIT_PANE_MESH]=b,f.showSplitPane&&(b.position.z=.5,this.addMesh(b));for(var w=o.GeometryGenerationHelpers.makeAndAddPlaneIntersection(this,e,t,b,x,f),C=(new l.PathFinder).findAllPathsOnMesh(v,w),P=0;P<C.length;P++){var S=new i.Geometry;S.vertices=C[P].map((function(e){return v.vertices[e]}));var _=new i.Line(S,new i.LineBasicMaterial({color:(0,c.randomWebColor)(M,"Mixed")}));_.position.y=-100,this.addMesh(_)}if(f.addPrecalculatedShapeOutlines){var A=new i.Geometry;A.vertices=w;var T=new i.Line(A,new i.LineBasicMaterial({color:8913064}));T.position.y=-100,T.position.z=-50,this.addMesh(T)}for(var I=[],M=0;M<C.length;M++){var E=o.GeometryGenerationHelpers.makePlaneTriangulation(this,v,C[M],f);I.push(E),f.closeCutAreas&&((0,h.mergeGeometries)(v,E,u.EPS),(0,h.mergeGeometries)(m,E,u.EPS))}if(f.showLeftSplit){v.uvsNeedUpdate=!0,v.buffersNeedUpdate=!0,v.computeVertexNormals();var N=new i.Mesh(v,y);if(N.position.y=-100,N.position.z=-50,N.userData.isExportable=!0,this.addMesh(N),f.showNormals){var L=new r.VertexNormalsHelper(N,f.normalsLength,65280);this.scene.add(L),this.geometries.push(L)}}if(f.showRightSplit){m.uvsNeedUpdate=!0,m.buffersNeedUpdate=!0,m.computeVertexNormals();var z=new i.Mesh(m,y);if(z.position.y=-100,z.position.z=50,z.userData.isExportable=!0,this.addMesh(z),f.showNormals){L=new r.VertexNormalsHelper(z,f.normalsLength,65280);this.scene.add(L),this.geometries.push(L)}}this.partialResults[u.KEY_LEFT_SLICE_PLANE]=g,this.partialResults[u.KEY_LEFT_SLICE_GEOMETRY]=v,this.partialResults[u.KEY_RIGHT_SLICE_PLANE]=p,this.partialResults[u.KEY_RIGHT_SLICE_GEOMETRY]=m,this.partialResults[u.KEY_PLANE_INTERSECTION_POINTS]=w,this.partialResults[u.KEY_SPLIT_TRIANGULATION_GEOMETRIES]=I},e.prototype.addMesh=function(e){e.rotation.x=Math.PI,this.scene.add(e),this.geometries.push(e)},e.prototype.removeCachedGeometries=function(){for(var e=0;e<this.geometries.length;e++){var t=this.geometries[e];this.scene.remove(t),t instanceof i.Mesh&&(t.geometry.dispose(),t.material.dispose())}this.geometries=[]},e.prototype.generateSTL=function(e,t){var s=[];for(var i in this.geometries)if(!0===this.geometries[i].userData.isExportable){var r=t.parse(this.geometries[i]);s.push(r)}"function"==typeof e.onComplete?e.onComplete(s.join("\n\n")):console.warn("STL data was generated but no 'onComplete' callback was defined.")},e}();t.DildoGeneration=f},938:function(e,t,s){var i,r=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function s(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)});Object.defineProperty(t,"__esModule",{value:!0}),t.DildoGeometry=t.DildoBaseClass=void 0;var n=s(690),a=s(212),o=s(787),h=s(11),l=s(280),c=Math.PI/180,u=function(){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]]};t.DildoBaseClass=u;var d=function(e){function t(t){var s=e.call(this)||this;return a.Geometry.call(s),s.vertexMatrix=[],s.topIndex=-1,s.bottomIndex=-1,s.spineVertices=[],s.outerPerpLines=[],s.innerPerpLines=[],s.flatSidePolygon=null,s.leftFlatIndices=[],s.rightFlatIndices=[],s.leftFlatTriangleIndices=[],s.rightFlatTriangleIndices=[],s.flatSideBounds=null,s.hollowBottomEdgeVertIndices=[],s.hollowBottomTriagles=[],s.dildoNormals=[],s._buildVertices(t),s._buildFaces(t),s._buildUVMapping(t),t.useBumpmap&&(t.bumpmapTexture?s.__applyBumpmap(t.bumpmapTexture):console.warn("Cannot apply bumpmap as desired, because the bumpmap texture is null or undefined.")),s}return r(t,e),t.prototype.__buildSlice=function(e,t,s,i,r,n,o,h,l){for(var c=(t.max.x-s.x)/t.width,u=0;u<e.vertices.length;u++){var d=e.vertices[u];if(n){var f=new a.Vector3(d.x*c,0,d.y*c);g(f,l,0,0),this._bendVertex(f,o,h,r),f.y+=t.max.y}else{f=new a.Vector3(d.x*c,s.y,d.y*c);g(f,l,0,0)}this.vertexMatrix[i][u]=this.vertices.length,this.vertices.push(f),0==i&&(0==u&&f.y,u+1==e.vertices.length&&f.y)}},t.prototype.__buildSpine=function(e,t,s,i,r,n,o){var h=(t.max.x-s.x)/t.width,l=e.clone();if(r){var c=new a.Vector3(l.x*h,0,l.y*h);this._bendVertex(c,n,o,i),c.y+=t.max.y}else c=new a.Vector3(l.x*h,s.y,l.y*h);this.spineVertices.push(c)},t.prototype.__buildPerps=function(e,t,s,i,r,n,h,l,c,u){for(var d=(t.max.x-s.x)/t.width,g=[0,Math.floor(e.vertices.length/2)],v=0;v<g.length;v++){var p=g[v],m=e.vertices[p];if(n){var y=new a.Vector3(m.x*d,0,m.y*d);this._bendVertex(y,h,l,r),y.y+=t.max.y}else y=new a.Vector3(m.x*d,s.y,m.y*d);var x=new a.Vector3(s.x-i.x,s.y-i.y,0);if(0==p)var b=new a.Vector3(y.x-i.x,y.y+i.y,0);else b=new a.Vector3(y.x+i.x,y.y+i.y,0);f(b,h*r,y.x,y.y);var w=y.clone();w.x+=x.x,w.y+=x.y,w.z+=x.z,c&&o.GeometryGenerationHelpers.normalizeVectorXY(y,b,u),0==p?this.outerPerpLines.push(new a.Line3(y,b)):this.innerPerpLines.push(new a.Line3(y,b))}},t.prototype.__makeFlatSideVertices=function(e){this.flatSidePolygon=new n.Polygon(this.getPerpendicularPathVertices(!0),!1),this.flatSideBounds=this.flatSidePolygon.getBounds();for(var t=0;t<this.flatSidePolygon.vertices.length;t++){var s=this.vertices.length;this.leftFlatIndices.push(s),this.vertices.push(new a.Vector3(this.flatSidePolygon.vertices[t].x,this.flatSidePolygon.vertices[t].y,e)),0!==t&&t+1!==this.flatSidePolygon.vertices.length&&t+2!==this.flatSidePolygon.vertices.length||this.hollowBottomEdgeVertIndices.push(s)}for(t=0;t<this.flatSidePolygon.vertices.length;t++){s=this.vertices.length;this.rightFlatIndices.push(s),this.vertices.push(new a.Vector3(this.flatSidePolygon.vertices[t].x,this.flatSidePolygon.vertices[t].y,-e)),0!==t&&t+1!==this.flatSidePolygon.vertices.length&&t+2!==this.flatSidePolygon.vertices.length||this.hollowBottomEdgeVertIndices.push(s)}},t.prototype.__makeFlatSideFaces=function(){for(var e=this,t=this.leftFlatIndices.map((function(t){return e.vertices[t]})),s=o.GeometryGenerationHelpers.flattenVert2dArray(t),i=(0,h.earcut)(s),r=0;r+2<i.length;r+=3){var n=i[r],a=i[r+1],l=i[r+2];o.GeometryGenerationHelpers.makeFace3(this,this.leftFlatIndices[n],this.leftFlatIndices[a],this.leftFlatIndices[l]),this.leftFlatTriangleIndices.push([this.leftFlatIndices[n],this.leftFlatIndices[a],this.leftFlatIndices[l]])}for(r=0;r+2<i.length;r+=3){n=i[r],a=i[r+1],l=i[r+2];o.GeometryGenerationHelpers.makeFace3(this,this.rightFlatIndices[n],this.rightFlatIndices[l],this.rightFlatIndices[a]),this.rightFlatTriangleIndices.push([this.rightFlatIndices[n],this.rightFlatIndices[a],this.rightFlatIndices[l]])}},t.prototype.getPerpendicularPathVertices=function(e,t){for(var s=[],i=0;i<this.innerPerpLines.length;i++)s.push(t?this.innerPerpLines[i].start:this.innerPerpLines[i].end);for(i=this.outerPerpLines.length-1;i>=0;i--)s.push(t?this.outerPerpLines[i].start:this.outerPerpLines[i].end);return e&&s.push(this.vertices[this.bottomIndex]),s},t.prototype.getPerpendicularHullLines=function(){for(var e=[],t=0;t<this.innerPerpLines.length;t++)e.push(this.innerPerpLines[t]);for(t=this.outerPerpLines.length-1;t>=0;t--)e.push(this.outerPerpLines[t]);return e},t.prototype._getTopVertex=function(e,t,s,i){if(t){var r=new a.Vector3(0,0,0);return this._bendVertex(r,s,i,1),r.y+=e.max.y,r}return new a.Vector3(0,e.min.y,0)},t.prototype._getBottomVertex=function(e){return new a.Vector3(0,e.max.y,0)},t.prototype._bendVertex=function(e,t,s,i){var r=new a.Vector3(0,0,1),n=t*i;e.x-=s,e.applyAxisAngle(r,n),e.x+=s},t.prototype.applyBumpMap=function(e){for(var t=0;t<this.vertexMatrix.length;t++)for(var s=0;s<this.vertexMatrix[t].length;s++){var i=this.vertexMatrix[t][s];this.vertices[i]}},t.prototype._buildFaces=function(e){var t=e.baseShape,s=e.outlineSegmentCount,i=Boolean(e.closeTop),r=Boolean(e.closeBottom),n=Boolean(e.makeHollow),a=t.vertices.length;this.faceVertexUvs[0]=[];for(var o=0;o<s;o++)for(var h=0;h<a;h++)o>0&&h>0&&(this.addFace4ByIndices(o,h-1,o-1,h,n),h+1==t.vertices.length&&this.addFace4ByIndices(o,h,o-1,0,n));n&&(this.__makeFlatSideFaces(),this.__makeBackFrontFaces()),r&&(n?this._buildHollowBottomFaces():this._buildEndFaces(this.bottomIndex,0,a,!1)),i&&this._buildEndFaces(this.topIndex,this.vertexMatrix.length-1,a,n)},t.prototype._buildHollowBottomFaces=function(){for(var e,t=this,s=this.hollowBottomEdgeVertIndices.map((function(e){return t.vertices[e]})),i=function(e){for(var i,r=0,n=Number.MAX_VALUE,a=0;a<s.length;a++){var o=t.hollowBottomEdgeVertIndices[a];(i=s[a].distanceTo(e))<n&&(r=o,n=i)}return r},r=this.vertexMatrix[0].length,n=i(this.vertices[r-1]),o=0;o<r;o++){var h=i(this.vertices[this.vertexMatrix[0][o]]);e=[n,this.vertexMatrix[0][0==o?r-1:o-1],this.vertexMatrix[0][o]],this.faces.push(new a.Face3(e[0],e[1],e[2])),this.hollowBottomTriagles.push(e),n!==h&&(e=[h,n,this.vertexMatrix[0][o]],this.faces.push(new a.Face3(e[0],e[1],e[2])),this.hollowBottomTriagles.push(e)),n=h}},t.prototype._buildEndFaces=function(e,t,s,i){for(var r=1;r<s;r++)o.GeometryGenerationHelpers.makeFace3(this,this.vertexMatrix[t][r-1],e,this.vertexMatrix[t][r],i),r+1==s&&o.GeometryGenerationHelpers.makeFace3(this,this.vertexMatrix[t][r],e,this.vertexMatrix[t][0],i)},t.prototype.__makeBackFrontFaces=function(){for(var e=1;e+1<this.flatSidePolygon.vertices.length;e++)o.GeometryGenerationHelpers.makeFace4(this,this.leftFlatIndices[e],this.leftFlatIndices[e-1],this.rightFlatIndices[e],this.rightFlatIndices[e-1])},t.prototype._buildUVMapping=function(e){for(var t=e.baseShape,s=e.outlineSegmentCount,i=t.vertices.length,r=Boolean(e.closeTop),n=Boolean(e.closeBottom),h=Boolean(e.makeHollow),c=1;c<s;c++)for(var u=1;u<t.vertices.length;u++)o.GeometryGenerationHelpers.addCylindricUV4(this,c,u-1,c-1,u,s,i,h),u+1==t.vertices.length&&o.GeometryGenerationHelpers.addCylindricUV4(this,c,u-1,c-1,u,s,i,h);if(h){for(u=0;u<this.leftFlatTriangleIndices.length;u++){var d=this.leftFlatTriangleIndices[u][0],f=this.leftFlatTriangleIndices[u][1],g=this.leftFlatTriangleIndices[u][2];l.UVHelpers.makeFlatTriangleUVs(this,this.flatSideBounds,d,f,g)}for(u=0;u<this.rightFlatTriangleIndices.length;u++){var p=this.rightFlatTriangleIndices[u][0],m=this.rightFlatTriangleIndices[u][2],y=this.rightFlatTriangleIndices[u][1];l.UVHelpers.makeFlatTriangleUVs(this,this.flatSideBounds,p,m,y)}for(u=1;u+1<this.flatSidePolygon.vertices.length;u++){var x=(u-1)/(this.flatSidePolygon.vertices.length-1),b=u/(this.flatSidePolygon.vertices.length-1);this.faceVertexUvs[0].push([new a.Vector2(0,b),new a.Vector2(0,x),new a.Vector2(1,b)]),this.faceVertexUvs[0].push([new a.Vector2(0,x),new a.Vector2(1,x),new a.Vector2(1,b)])}}if(n)if(h)v(this,this.hollowBottomEdgeVertIndices,this.hollowBottomTriagles);else for(u=1;u<i;u++)o.GeometryGenerationHelpers.addPyramidalBaseUV3(this,u-1,i),u+1==i&&o.GeometryGenerationHelpers.addPyramidalBaseUV3(this,u-1,i);if(r){var w=s-1;for(u=1;u<i;u++)o.GeometryGenerationHelpers.addPyramidalBaseUV3(this,u-1,i),u+1==i&&o.GeometryGenerationHelpers.addPyramidalBaseUV3(this,w,i)}this.uvsNeedUpdate=!0},t.prototype.addFace4ByIndices=function(e,t,s,i,r){o.GeometryGenerationHelpers.makeFace4(this,this.vertexMatrix[e][t],this.vertexMatrix[s][t],this.vertexMatrix[e][i],this.vertexMatrix[s][i],r)},t.prototype._buildVertices=function(e){for(var t=e.baseShape,s=e.outline,i=e.outlineSegmentCount,r=Boolean(e.makeHollow),n=e.bendAngle/180*Math.PI,a=e.hollowStrengthX,o=e.twistAngle*c,h=Boolean(e.normalizePerpendiculars),l=void 0!==e.normalsLength?e.normalsLength:10,u=s.getBounds(),d=u.height,f=t.getBounds(),g=f.getCenter(),v=d/n,p=e.isBending&&!isNaN(v)&&v!==Number.POSITIVE_INFINITY&&v!==Number.NEGATIVE_INFINITY&&Math.abs(n)>.01,m=0;m<i;m++){var y=Math.min(1,Math.max(0,m/(i-1)));this.vertexMatrix[m]=[];var x=s.getPointAt(y),b=s.getPerpendicularAt(y),w=(u.max.y-x.y)/d,C=m/(i-1);this.__buildSlice(t,u,x,m,w,p,n,v,o*C),this.__buildSpine(g,u,x,w,p,n,v),this.__buildPerps(t,u,x,b,w,p,n,v,h,l)}var P=this._getTopVertex(u,p,n,v),S=this._getBottomVertex(u);this.topIndex=this.vertices.length,this.vertices.push(P),this.bottomIndex=this.vertices.length,this.vertices.push(S),r&&this.__makeFlatSideVertices(Math.max(f.width,f.height)/2+a)},t.prototype.__applyBumpmap=function(e){for(var t=0;t<this.vertexMatrix.length;t++)for(var s=0;s<this.vertexMatrix[t].length;s++);},t}(u);t.DildoGeometry=d;var f=function(e,t,s,i){var r=new a.Vector3(0,0,1);return e.x-=s,e.y-=i,e.applyAxisAngle(r,t),e.x+=s,e.y+=i,e},g=function(e,t,s,i){var r=new a.Vector3(0,1,0);return e.x-=s,e.z-=i,e.applyAxisAngle(r,t),e.x+=s,e.z+=i,e},v=function(e,t,s){for(var i=n.Bounds.computeFromVertices(t.map((function(t){return new n.Vertex(e.vertices[t].x,e.vertices[t].z)}))),r=function(e){return new a.Vector2((e.x-i.min.x)/i.width,(e.z-i.min.y)/i.height)},o=0;o<s.length;o++){var h=e.vertices[s[o][0]],l=e.vertices[s[o][1]],c=e.vertices[s[o][2]];e.faceVertexUvs[0].push([r(h),r(l),r(c)])}}},498:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DildoMaterials=void 0;var i,r,n=s(212);t.DildoMaterials=(i=new Map,r={createMainMaterial:function(e,t,s,i){return e?new n.MeshLambertMaterial({color:16777215,wireframe:t,depthTest:!0,opacity:1,side:i,visible:!0,emissive:0,reflectivity:1,refractionRatio:.89,map:r.loadTextureImage(s)}):new n.MeshPhongMaterial({color:3684607,wireframe:t,flatShading:!1,depthTest:!0,opacity:1,side:i,visible:!0,emissive:0,reflectivity:1,refractionRatio:.89,map:null})},createSliceMaterial:function(e,t,s){return t?new n.MeshBasicMaterial({wireframe:!0}):new n.MeshLambertMaterial({color:e?8947848:169363624,wireframe:!1,depthTest:!0,opacity:1,side:n.DoubleSide,visible:!0,emissive:0,reflectivity:1,refractionRatio:.89,map:e?r.loadTextureImage(s):null,vertexColors:!1})},loadTextureImage:function(e){var t=i.get(e);return t||(t=(new n.TextureLoader).load(e),i.set(e,t)),t}})},787:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GeometryGenerationHelpers=void 0;var i=s(212),r=s(11),n=s(690),a=s(562),o=s(834),h=s(659),l=s(280),c=s(507);t.GeometryGenerationHelpers={makeFace3:function(e,t,s,r,n){n?e.faces.push(new i.Face3(r,s,t)):e.faces.push(new i.Face3(t,s,r))},makeFace4:function(e,s,i,r,n,a){a?(t.GeometryGenerationHelpers.makeFace3(e,s,r,i,!1),t.GeometryGenerationHelpers.makeFace3(e,r,n,i,!1)):(t.GeometryGenerationHelpers.makeFace3(e,s,i,r,!1),t.GeometryGenerationHelpers.makeFace3(e,i,n,r,!1))},addCylindricUV4:function(e,t,s,r,n,a,o,h){h?(e.faceVertexUvs[0].push([new i.Vector2(t/a,s/o),new i.Vector2(t/a,n/o),new i.Vector2(r/a,s/o)]),e.faceVertexUvs[0].push([new i.Vector2(t/a,n/o),new i.Vector2(r/a,n/o),new i.Vector2(r/a,s/o)])):(e.faceVertexUvs[0].push([new i.Vector2(t/a,s/o),new i.Vector2(r/a,s/o),new i.Vector2(t/a,n/o)]),e.faceVertexUvs[0].push([new i.Vector2(r/a,s/o),new i.Vector2(r/a,n/o),new i.Vector2(t/a,n/o)]))},addPyramidalBaseUV3:function(e,t,s){var r=1-2*Math.abs(.5-t/s),n=1-2*Math.abs(.5-(t+1)/s);e.faceVertexUvs[0].push([new i.Vector2(r,0),new i.Vector2(.5,1),new i.Vector2(n,0)])},flattenVert2dArray:function(e){for(var t=[],s=0;s<e.length;s++)t.push(e[s].x,e[s].y);return t},mkCircularPolygon:function(e,t,s){void 0===s&&(s=1);for(var i,r=[],a=0;a<t;a++)i=2*Math.PI*(a/t),r.push(new n.Vertex(Math.cos(i)*e*s,Math.sin(i)*e));return new n.Polygon(r,!1)},makeSlice:function(e,t){var s=(0,a.sliceGeometry)(e,t,!1);return s.mergeVertices(),s.computeFaceNormals(),s},makeAndAddPlaneIntersection:function(e,s,n,a,l,c){var u=(new o.PlaneMeshIntersection).getIntersectionPoints(s,n,a,l),d=(0,h.clearDuplicateVertices3)(u,1e-6),f=new i.Geometry;f.vertices=d;var g=new i.PointsMaterial({size:1.4,color:65535}),v=new i.Points(f,g);c.showSplitShape&&(v.position.y=-100,v.position.z=-50,e.addMesh(v));for(var p=t.GeometryGenerationHelpers.flattenVert2dArray(d),m=(0,r.earcut)(p),y=new i.Geometry,x=0;x<d.length;x++)y.vertices.push(d[x].clone());for(x=0;x+2<m.length;x+=3){var b=m[x],w=m[x+1],C=m[x+2];t.GeometryGenerationHelpers.makeFace3(y,b,w,C)}if(c.addRawIntersectionTriangleMesh){var P=new i.Mesh(y,new i.LineBasicMaterial({color:16746496}));P.position.y=-100,P.position.z=-50,e.addMesh(P)}return c.addPrecalculatedMassiveFaces&&t.GeometryGenerationHelpers.makeAndAddMassivePlaneIntersection(e,n),c.addPrecalculatedHollowFaces&&t.GeometryGenerationHelpers.makeAndAddHollowPlaneIntersection(e,n),d},makeAndAddMassivePlaneIntersection:function(e,s){var n=s.getPerpendicularPathVertices(!0,!0),a=new i.Geometry;a.vertices=n;for(var o=new i.MeshBasicMaterial({wireframe:!1,color:16711680,opacity:.5,side:i.DoubleSide,transparent:!0}),h=t.GeometryGenerationHelpers.flattenVert2dArray(n),l=(0,r.earcut)(h),c=0;c+2<l.length;c+=3){var u=l[c],d=l[c+1],f=l[c+2];t.GeometryGenerationHelpers.makeFace3(a,u,d,f)}var g=new i.Mesh(a,o);g.position.y=-100,g.position.z=50,g.userData.isExportable=!1,e.addMesh(g)},makeAndAddHollowPlaneIntersection:function(e,t){for(var s=new i.Geometry,r=t.getPerpendicularHullLines(),n=0;n<r.length;n++){var a=r[n].start,o=r[n].end;s.vertices.push(a,o);var h=s.vertices.length;n>0&&(s.faces.push(new i.Face3(h-4,h-2,h-3)),s.faces.push(new i.Face3(h-3,h-2,h-1)))}var l=new i.MeshBasicMaterial({wireframe:!1,color:16711680,opacity:.5,side:i.DoubleSide,transparent:!0}),c=new i.Mesh(s,l);c.position.y=-100,c.position.z=-50,c.userData.isExportable=!1,e.addMesh(c)},addSpine:function(e,t){var s=new i.LineSegments(t,new i.LineBasicMaterial({color:16746496}));s.position.y=-100,e.addMesh(s)},addPerpendicularPaths:function(e,s){t.GeometryGenerationHelpers.addPerpendicularPath(e,s.outerPerpLines,16711680),t.GeometryGenerationHelpers.addPerpendicularPath(e,s.innerPerpLines,65280)},addPerpendicularPath:function(e,t,s){var r=new i.Geometry;t.forEach((function(e){r.vertices.push(e.start.clone()),r.vertices.push(e.end.clone())}));var n=new i.LineSegments(r,new i.LineBasicMaterial({color:s}));n.position.y=-100,e.addMesh(n)},makePlaneTriangulation:function(e,t,s,a){var o=s.reduce((function(e,s){var i=t.vertices[s];return e.push(i.x,i.y),e}),[]),h=(0,r.earcut)(o),u=new i.Geometry;u.vertices=s.map((function(e){return t.vertices[e]}));for(var d=n.Bounds.computeFromVertices(u.vertices.map((function(e){return new n.Vertex(e.x,e.y)}))),f=0;f<h.length;f+=3){var g=h[f],v=h[f+1],p=h[f+2];u.faces.push(new i.Face3(g,v,p)),l.UVHelpers.makeFlatTriangleUVs(u,d,g,v,p)}u.uvsNeedUpdate=!0,u.buffersNeedUpdate=!0,u.computeVertexNormals();var m=new i.Mesh(u,new i.MeshBasicMaterial({color:18687,transparent:!0,opacity:.55,side:i.DoubleSide}));return m.position.y=-100,m.userData.isExportable=!1,e.partialResults[c.KEY_PLANE_INTERSECTION_TRIANGULATION]=u,a.showSplitShapeTriangulation&&e.addMesh(m),u},normalizeVectorXY:function(e,t,s){var i=t.x-e.x,r=t.y-e.y,n=s/Math.sqrt(i*i+r*r);t.x=e.x+i*n,t.y=e.y+r*n},normalizeVectorXYZ:function(e,t,s){var i=t.x-e.x,r=t.y-e.y,n=t.z-e.z,a=s/Math.sqrt(i*i+r*r+n*n);t.x=e.x+i*a,t.y=e.y+r*a,t.z=e.z+n*a},removeAllChildNodes:function(e){for(;e.lastChild;)e.removeChild(e.lastChild)},clamp:function(e,t,s){return Math.max(Math.min(e,s),t)}}},479:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.ImageStore=void 0,t.ImageStore=(s=new Map,{getImage:function(e,t){var i=s.get(e);return i||(i=document.createElement("img"),s.set(e,i),i.onload=function(){t(i)},i.setAttribute("src",e)),i},isImageLoaded:function(e){return e.complete&&0!==e.naturalHeight&&void 0!==e.naturalHeight}})},41:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PathFinder=void 0;var i=s(507),r=function(){function e(e){this.visitedVertices=new Set,this.unvisitedVertIndices=new Set,this.numVisitedVertices=0,this.epsilon=void 0!==e&&e>=0?e:i.EPS}return e.prototype.findAllPathsOnMesh=function(e,t){var s=[];this.visitedVertices.clear(),this.unvisitedVertIndices.clear();var i=a(e,t,this.epsilon),r=i.length;for(this.unvisitedVertIndices=new Set(i.map((function(e,t){return t})));this.numVisitedVertices<r;){var n=this.unvisitedVertIndices.values().next().value,o=this.findUnvisitedPaths(e,i,n);s.push(o)}return this.combineAdjacentPaths(s,e)},e.prototype.findUnvisitedPaths=function(e,t,s){var i,r=[s];for(this.visitedVertices.add(s),this.unvisitedVertIndices.delete(s),this.numVisitedVertices++;-1!==(i=this.findAdjacentFace(e,t,s));)r.push(i),this.visitedVertices.add(i),this.unvisitedVertIndices.delete(i),this.numVisitedVertices++,s=i;return r},e.prototype.findAdjacentFace=function(e,t,s){for(var i=e.faces.length,r=0;r<i;r++)if(n(e,r,s))for(var a=0;a<t.length;a++){var o=t[a];if(o!==s&&!this.isVisited(o)){if(!this.isVisited(o)&&n(e,r,o))return o;if(n(e,r,o))return o}}return-1},e.prototype.isVisited=function(e){return this.visitedVertices.has(e)},e.prototype.combineAdjacentPaths=function(e,t){for(var s=[],i=new Set(e.map((function(e,t){return t})));i.size>0;){var r=i.values().next().value;i.delete(r);var n=e[r],a=null;do{!(a=o(e,n[n.length-1],i,t))&&n.length>1&&(n=n.reverse(),a=o(e,n[n.length-1],i,t)),a&&(n=n.concat(a))}while(a);s.push(n)}return s},e}();t.PathFinder=r;var n=function(e,t,s){var i=e.faces[t];return i.a===s||i.b===s||i.c===s},a=function(e,t,s){for(var i=[],r=0;r<t.length;r++){for(var n=t[r],a=-1,o=s,h=0;h<e.vertices.length;h++){var l=e.vertices[h].distanceTo(n);l<=o&&(-1===a||-1!==a&&e.vertices[a].distanceTo(n)>=l&&a>h)&&(a=h,o=l)}-1===a?console.warn("PathFinder.mapVerticesToGeometryIndices could not find a matching geometry vertex for path point "+r+". The final result might be locally broken."):i.push(a)}return i},o=function(e,t,s,i){for(var r=0;r<i.faces.length;r++)if(n(i,r,t))for(var a=0;a<e.length;a++)if(s.has(a)){var o=e[a];if(n(i,r,o[0]))return s.delete(a),o;if(n(i,r,o[o.length-1]))return s.delete(a),o.reverse()}}},834:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlaneMeshIntersection=void 0;var i=s(212),r=function(){var e=this;this.getIntersectionPoints=function(t,s,r,n){e.pointsOfIntersection=[];var a=new i.Plane;r.localToWorld(e.planePointA.copy(n.vertices[n.faces[0].a])),r.localToWorld(e.planePointB.copy(n.vertices[n.faces[0].b])),r.localToWorld(e.planePointC.copy(n.vertices[n.faces[0].c])),a.setFromCoplanarPoints(e.planePointA,e.planePointB,e.planePointC);var o=e;return s.faces.forEach((function(e){t.localToWorld(o.a.copy(s.vertices[e.a])),t.localToWorld(o.b.copy(s.vertices[e.b])),t.localToWorld(o.c.copy(s.vertices[e.c])),o.lineAB=new i.Line3(o.a,o.b),o.lineBC=new i.Line3(o.b,o.c),o.lineCA=new i.Line3(o.c,o.a),o.__setPointOfIntersection(o.lineAB,a),o.__setPointOfIntersection(o.lineBC,a),o.__setPointOfIntersection(o.lineCA,a)})),e.pointsOfIntersection},this.__setPointOfIntersection=function(e,t){var s=t.intersectLine(e,this.pointOfIntersection);s&&this.pointsOfIntersection.push(s.clone())},this.pointsOfIntersection=[],this.a=new i.Vector3,this.b=new i.Vector3,this.c=new i.Vector3,this.planePointA=new i.Vector3,this.planePointB=new i.Vector3,this.planePointC=new i.Vector3,this.lineAB=new i.Line3,this.lineBC=new i.Line3,this.lineCA=new i.Line3,this.pointOfIntersection=new i.Vector3};t.PlaneMeshIntersection=r},280:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UVHelpers=void 0;var i=s(212);t.UVHelpers={makeFlatTriangleUVs:function(e,t,s,r,n){var a=e.vertices[s],o=e.vertices[r],h=e.vertices[n],l=function(e){return new i.Vector2((e.x-t.min.x)/t.width,(e.y-t.min.y)/t.height)};e.faceVertexUvs[0].push([l(a),l(o),l(h)])}}},659:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clearDuplicateVertices3=void 0;t.clearDuplicateVertices3=function(e,t){void 0===t&&(t=1e-6);for(var i=[],r=0;r<e.length;r++)s(e,e[r],r+1,t)||i.push(e[r]);return i};var s=function(e,t,s,i){for(var r=s;r<e.length;r++)if(n=e[r],a=t,o=i,n.distanceTo(a)<o)return!0;var n,a,o;return!1}},224:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.computeVertexNormals=void 0;var i=s(212);t.computeVertexNormals=function(e,t){for(var s=t.getAttribute("normal"),a=Array(e.faces.length),o=0;o<e.faces.length;o++){var h=e.faces[o],l=new i.Vector3(s.array[9*o+0],s.array[9*o+1],s.array[9*o+2]),c=new i.Vector3(s.array[9*o+3],s.array[9*o+4],s.array[9*o+5]),u=new i.Vector3(s.array[9*o+6],s.array[9*o+7],s.array[9*o+8]);r(a,h.a,l),r(a,h.b,c),r(a,h.c,u)}for(var d=new Array(e.vertices.length),f=0;f<e.vertices.length;f++){var g=n(a[f]);g.add(e.vertices[f]),d[f]=new i.Line3(e.vertices[f],g)}return d};var r=function(e,t,s){(t>=e.length||void 0===e[t])&&(e[t]=[]),e[t].push(s)},n=function(e){var t=new i.Vector3(0,0,0);return e&&(e.forEach((function(e){t.add(e)})),t.divideScalar(e.length)),t}},507:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.KEY_SPLIT_TRIANGULATION_GEOMETRIES=t.KEY_PLANE_INTERSECTION_TRIANGULATION=t.KEY_PLANE_INTERSECTION_POINTS=t.KEY_SPLIT_PANE_MESH=t.KEY_RIGHT_SLICE_PLANE=t.KEY_LEFT_SLICE_PLANE=t.KEY_RIGHT_SLICE_GEOMETRY=t.KEY_LEFT_SLICE_GEOMETRY=t.DEG_TO_RAD=t.EPS=void 0,t.EPS=1e-6,t.DEG_TO_RAD=Math.PI/180,t.KEY_LEFT_SLICE_GEOMETRY="KEY_LEFT_SLICE_GEOMETRY",t.KEY_RIGHT_SLICE_GEOMETRY="KEY_RIGHT_SLICE_GEOMETRY",t.KEY_LEFT_SLICE_PLANE="KEY_LEFT_SLICE_PLANE",t.KEY_RIGHT_SLICE_PLANE="KEY_RIGHT_SLICE_PLANE",t.KEY_SPLIT_PANE_MESH="KEY_SPLIT_PANE_MESH",t.KEY_PLANE_INTERSECTION_POINTS="KEY_PLANE_INTERSECTION_POINTS",t.KEY_PLANE_INTERSECTION_TRIANGULATION="KEY_PLANE_INTERSECTION_TRIANGULATION",t.KEY_SPLIT_TRIANGULATION_GEOMETRIES="KEY_SPLIT_TRIANGULATION_GEOMETRIES"},555:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_BEZIER_JSON=void 0,t.DEFAULT_BEZIER_JSON='\n  [\n    {\n       "startPoint":[\n          -122,\n          77.80736634304651\n       ],\n       "endPoint":[\n          -65.59022229786551,\n          21.46778533702511\n       ],\n       "startControlPoint":[\n          -121.62058129515852,\n          25.08908859418696\n       ],\n       "endControlPoint":[\n          -79.33419353770395,\n          48.71529293460728\n       ]\n    },\n    {\n       "startPoint":[\n          -65.59022229786551,\n          21.46778533702511\n       ],\n       "endPoint":[\n          -65.66917273472913,\n          -149.23537680826058\n       ],\n       "startControlPoint":[\n          -52.448492057756646,\n          -4.585775770903305\n       ],\n       "endControlPoint":[\n          -86.1618869001374,\n          -62.11613821618976\n       ]\n    },\n    {\n       "startPoint":[\n          -65.66917273472913,\n          -149.23537680826058\n       ],\n       "endPoint":[\n          -61.86203591980055,\n          -243.8368165606738\n       ],\n       "startControlPoint":[\n          -53.701578771473564,\n          -200.1123697454778\n       ],\n       "endControlPoint":[\n          -69.80704300441666,\n          -205.36451303641783\n       ]\n    },\n    {\n       "startPoint":[\n          -61.86203591980055,\n          -243.8368165606738\n       ],\n       "endPoint":[\n          -21.108966092052256,\n          -323\n       ],\n       "startControlPoint":[\n          -54.08681426887413,\n          -281.486963896856\n       ],\n       "endControlPoint":[\n          -53.05779349623559,\n          -323\n       ]\n    }\n ]\n  '},333:(e,t,s)=>{globalThis.ngdg=s(619)._},557:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.locateVertexInArray=void 0;t.locateVertexInArray=function(e,t,s){for(var i=Number.POSITIVE_INFINITY,r=-1,n=0;n<e.length;n++){var a=e[n].distanceTo(t);-1===r&&a<i&&a<s&&(r=n,i=a)}return r}},752:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mergeAndMapVertices=t.mergeGeometries=void 0;var i=s(212),r=s(557);t.mergeGeometries=function(e,s,r){void 0===r&&(r=1e-6);for(var n=(0,t.mergeAndMapVertices)(e,s,r),a=0;a<s.faces.length;a++){var o=s.faces[a],h=n[o.a],l=n[o.b],c=n[o.c];if(e.faces.push(new i.Face3(h,l,c)),s.faceVertexUvs.length>0&&a<s.faceVertexUvs[0].length){var u=s.faceVertexUvs[0][a];e.faceVertexUvs[0].push([u[0].clone(),u[1].clone(),u[2].clone()])}else e.faceVertexUvs[0].push([new i.Vector2(0,0),new i.Vector2(0,1),new i.Vector2(1,.5)])}};t.mergeAndMapVertices=function(e,t,s){for(var i=[],n=0;n<t.vertices.length;n++){var a=t.vertices[n],o=(0,r.locateVertexInArray)(e.vertices,a,s);-1===o?(i.push(e.vertices.length),e.vertices.push(a.clone())):i.push(o)}return i}},619:(e,t,s)=>{t._=void 0;var i=s(555),r=s(479),n=s(615);t._={DEFAULT_BEZIER_JSON:i.DEFAULT_BEZIER_JSON,DildoGeneration:n.DildoGeneration,ImageStore:r.ImageStore}},541:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.randomWebColor=void 0;var i=s(566),r=s(858),n=s(586);t.randomWebColor=function(e,t){if(void 0===e){var s=Math.max(void 0!==i.WebColorsMalachite?i.WebColorsMalachite.length:0,void 0!==r.WebColorsContrast?r.WebColorsContrast.length:0,void 0!==n.WebColors?n.WebColors.length:0);e=Math.round(Math.random()*s)}switch(t){case"Malachite":if(void 0!==i.WebColorsMalachite)return i.WebColorsMalachite[e%i.WebColorsMalachite.length].cssRGB();console.warn("You decided to use the 'WebColorsMalachite' color palette but it is not installed. Falling back.");case"Mixed":if(void 0!==r.WebColorsContrast)return r.WebColorsContrast[e%r.WebColorsContrast.length].cssRGB();console.warn("You decided to use the 'WebColorsContrast' color palette but it is not installed. Falling back.");default:return n.WebColors[e%n.WebColors.length].cssRGB()}}},690:(e,t,s)=>{s.r(t),s.d(t,{BezierPath:()=>d,Bounds:()=>h,Circle:()=>g,CircleSector:()=>v,CubicBezierCurve:()=>u,Grid:()=>C,KeyHandler:()=>P,Line:()=>f,MouseHandler:()=>A,PBImage:()=>T,PlotBoilerplate:()=>L,Polygon:()=>o,SVGBuilder:()=>z,Triangle:()=>b,UIDGenerator:()=>i,VEllipse:()=>E,VEllipseSector:()=>N,Vector:()=>c,VertTuple:()=>l,Vertex:()=>a,VertexAttr:()=>r,VertexListeners:()=>n,XMouseEvent:()=>S,XWheelEvent:()=>_,drawutils:()=>m,drawutilsgl:()=>y,drawutilssvg:()=>p,geomutils:()=>w});class i{static next(){return""+i.current++}}i.current=0;class r{constructor(){for(var e in this.draggable=!0,this.selectable=!0,this.isSelected=!1,this.visible=!0,r.model)this[e]=r.model[e]}}r.model={draggable:!0,selectable:!0,isSelected:!1,visible:!0};class n{constructor(e){this.click=[],this.drag=[],this.dragStart=[],this.dragEnd=[],this.vertex=e}addClickListener(e){return n._addListener(this.click,e),this}removeClickListener(e){return this.click=n._removeListener(this.click,e),this}addDragListener(e){return n._addListener(this.drag,e),this}removeDragListener(e){return this.drag=n._removeListener(this.drag,e),this}addDragStartListener(e){return n._addListener(this.dragStart,e),this}removeDragStartListener(e){return this.dragStart=n._removeListener(this.dragStart,e),this}addDragEndListener(e){return n._addListener(this.dragEnd,e),this}removeDragEndListener(e){return this.dragEnd=n._removeListener(this.dragEnd,e),this}fireClickEvent(e){n._fireEvent(this,this.click,e)}fireDragEvent(e){n._fireEvent(this,this.drag,e)}fireDragStartEvent(e){n._fireEvent(this,this.dragStart,e)}fireDragEndEvent(e){n._fireEvent(this,this.dragEnd,e)}static _fireEvent(e,t,s){const i=s;for(var r in void 0===i.params?i.params={vertex:e.vertex}:i.params.vertex=e.vertex,t)t[r](i)}static _addListener(e,t){for(var s in e)if(e[s]==t)return!1;return e.push(t),!0}static _removeListener(e,t){for(var s=0;s<e.length;s++)if(e[s]==t)return e.splice(s,1);return e}}class a{constructor(e,t){if(this.className="Vertex",this.uid=i.next(),void 0===e)this.x=0,this.y=0;else if("number"==typeof e&&"number"==typeof t)this.x=e,this.y=t;else{const s=e;"number"==typeof s.x&&"number"==typeof s.y?(this.x=s.x,this.y=s.y):(this.x="number"==typeof e?e:void 0===e?0:NaN,this.y="number"==typeof t?t:void 0===t?0:NaN)}this.attr=new r,this.listeners=new n(this)}set(e,t){if("number"==typeof e&&"number"==typeof t)this.x=e,this.y=t;else{const s=e;"number"==typeof s.x&&"number"==typeof s.y?(this.x=s.x,this.y=s.y):(this.x="number"==typeof e?e:void 0===e?0:NaN,this.y="number"==typeof t?t:void 0===t?0:NaN)}return this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}invX(){return this.x=-this.x,this}invY(){return this.y=-this.y,this}add(e,t){if("number"==typeof e&&"number"==typeof t)this.x+=e,this.y+=t;else{const s=e;if("number"==typeof s.x&&"number"==typeof s.y)this.x+=s.x,this.y+=s.y;else{if("number"!=typeof e)throw`Cannot add ${typeof e} to numeric x component!`;if(this.x+=e,"number"!=typeof t)throw`Cannot add ${typeof t} to numeric y component!`;this.y+=t}}return this}addXY(e,t){return this.x+=e,this.y+=t,this}addX(e){return this.x+=e,this}addY(e){return this.y+=e,this}sub(e,t){if("number"==typeof e&&"number"==typeof t)this.x-=e,this.y-=t;else{const s=e;if("number"==typeof s.x&&"number"==typeof s.y)this.x-=s.x,this.y-=s.y;else{if("number"!=typeof e)throw`Cannot add ${typeof e} to numeric x component!`;if(this.x-=e,"number"!=typeof t)throw`Cannot add ${typeof t} to numeric y component!`;this.y-=t}}return this}equals(e){var t=Math.abs(this.x-e.x)<a.EPSILON,s=Math.abs(this.y-e.y)<a.EPSILON;return t&&s}clone(){return new a(this.x,this.y)}distance(e){return Math.sqrt(Math.pow(e.x-this.x,2)+Math.pow(e.y-this.y,2))}angle(e){const t=void 0===e?Math.PI/2-Math.atan2(this.x,this.y):Math.PI/2-Math.atan2(e.x-this.x,e.y-this.y);return t<0?2*Math.PI+t:t}difference(e){return new a(e.x-this.x,e.y-this.y)}scale(e,t){return t&&void 0!==t||(t=new a(0,0)),this.x=t.x+(this.x-t.x)*e,this.y=t.y+(this.y-t.y)*e,this}rotate(e,t){t&&void 0!==t||(t={x:0,y:0}),this.sub(t),e+=Math.atan2(this.y,this.x);let s=this.distance(a.ZERO);return this.x=s*Math.cos(e),this.y=s*Math.sin(e),this.add(t),this}multiplyScalar(e){return this.x*=e,this.y*=e,this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}inv(){return this.x=-this.x,this.y=-this.y,this}toString(){return"("+this.x+","+this.y+")"}toSVGString(e){e=e||{};var t=[];return t.push("<circle"),e.className&&t.push(' class="'+e.className+'"'),t.push(' cx="'+this.x+'"'),t.push(' cy="'+this.y+'"'),t.push(' r="2"'),t.push(" />"),t.join("")}static randomVertex(e){return new a(e.min.x+Math.random()*(e.max.x-e.min.x),e.min.y+Math.random()*(e.max.y-e.min.y))}}a.ZERO=new a(0,0),a.EPSILON=1e-6,a.utils={buildArrowHead:(e,t,s,i,r)=>{var n=Math.atan2((t.y-e.y)*r,(t.x-e.x)*i),o=[];return o.push(new a(t.x*i-s*Math.cos(n),t.y*r-s*Math.sin(n))),o.push(new a(t.x*i-1.35*s*Math.cos(n-Math.PI/8),t.y*r-1.35*s*Math.sin(n-Math.PI/8))),o.push(new a(t.x*i,t.y*r)),o.push(new a(t.x*i-1.35*s*Math.cos(n+Math.PI/8),t.y*r-1.35*s*Math.sin(n+Math.PI/8))),o}};class o{constructor(e,t){this.className="Polygon",this.uid=i.next(),void 0===e&&(e=[]),this.vertices=e,this.isOpen=t}addVertex(e){this.vertices.push(e)}getVertexAt(e){return e<0?this.vertices[this.vertices.length-Math.abs(e)%this.vertices.length]:this.vertices[e%this.vertices.length]}move(e){for(var t in this.vertices)this.vertices[t].add(e);return this}containsVert(e){for(var t=!1,s=0,i=this.vertices.length-1;s<this.vertices.length;i=s++){let r=this.vertices[s].x,n=this.vertices[s].y,a=this.vertices[i].x,o=this.vertices[i].y;n>e.y!=o>e.y&&e.x<(a-r)*(e.y-n)/(o-n)+r&&(t=!t)}return t}area(){return o.utils.area(this.vertices)}signedArea(){return o.utils.signedArea(this.vertices)}isClockwise(){return o.utils.signedArea(this.vertices)<0}scale(e,t){for(var s in this.vertices)"function"==typeof this.vertices[s].scale?this.vertices[s].scale(e,t):console.log("There seems to be a null vertex!",this.vertices[s]);return this}rotate(e,t){for(var s in this.vertices)this.vertices[s].rotate(e,t);return this}getBounds(){return h.computeFromVertices(this.vertices)}toQuadraticBezierData(){if(this.vertices.length<3)return[];var e=[],t=this.vertices[0],s=this.vertices[1],i=new a(t.x+(s.x-t.x)/2,t.y+(s.y-t.y)/2);e.push(i);for(var r=this.isOpen?this.vertices.length:this.vertices.length+1,n=1;n<r;n++){t=this.vertices[n%this.vertices.length],s=this.vertices[(n+1)%this.vertices.length];i=new a(t.x+(s.x-t.x)/2,t.y+(s.y-t.y)/2);e.push(t),e.push(i),t=s}return e}toQuadraticBezierSVGString(){var e=this.toQuadraticBezierData();if(0==e.length)return"";for(var t=["M "+e[0].x+" "+e[0].y],s=1;s<e.length;s+=2)t.push("Q "+e[s].x+" "+e[s].y+", "+e[s+1].x+" "+e[s+1].y);return t.join(" ")}toCubicBezierData(e){if(void 0===e&&(e=1),this.vertices.length<3)return[];var t=[],s=this.vertices[0],i=this.vertices[1],r=new a(s.x+(i.x-s.x)/2,s.y+(i.y-s.y)/2);t.push(r);for(var n=this.isOpen?this.vertices.length-1:this.vertices.length,o=0;o<n;o++){s=this.vertices[o%this.vertices.length],i=this.vertices[(o+1)%this.vertices.length];var h=this.vertices[(o+2)%this.vertices.length],l=new a(s.x+(i.x-s.x)/2,s.y+(i.y-s.y)/2),c=new a(i.x+(h.x-i.x)/2,i.y+(h.y-i.y)/2),u=new a(l.x+(i.x-l.x)*e,l.y+(i.y-l.y)*e),d=new a(c.x+(i.x-c.x)*e,c.y+(i.y-c.y)*e);t.push(u),t.push(d),t.push(c)}return t}toCubicBezierSVGString(e){var t=this.toCubicBezierData(e);if(0==t.length)return"";for(var s=["M "+t[0].x+" "+t[0].y],i=1;i<t.length;i+=3)s.push("C "+t[i].x+" "+t[i].y+", "+t[i+1].x+" "+t[i+1].y+", "+t[i+2].x+" "+t[i+2].y);return s.join(" ")}toCubicBezierPath(e){for(var t=this.toCubicBezierData(e),s=[],i=0;i+3<t.length;i+=3)s.push([t[i],t[i+3],t[i+1],t[i+2]]);return d.fromArray(s)}toSVGString(e){e=e||{};var t=[];if(t.push("<path"),e.className&&t.push(' class="'+e.className+'"'),t.push(' d="'),this.vertices.length>0){t.push("M "),t.push(this.vertices[0].x.toString()),t.push(" "),t.push(this.vertices[0].y.toString());for(var s=1;s<this.vertices.length;s++)t.push(" L "),t.push(this.vertices[s].x.toString()),t.push(" "),t.push(this.vertices[s].y.toString());this.isOpen||t.push(" Z")}return t.push('" />'),t.join("")}}o.utils={area(e){let t=0;for(var s=0,i=e.length;s<i;s++){t+=e[s].x*e[(s+1)%i].y*.5,t-=e[(s+1)%i].x*e[s].y*.5}return Math.abs(t)},signedArea(e){let t=0;const s=e.length;for(var i=0;i<s;i++){const r=(i+1)%s;t+=(e[r].x-e[i].x)*(e[i].y+e[r].y)}return t}};class h{constructor(e,t){this.min=e,this.max=t,this.width=t.x-e.x,this.height=t.y-e.y}toPolygon(){return new o([new a(this.min),new a(this.max.x,this.min.y),new a(this.max),new a(this.min.x,this.max.y)],!1)}getCenter(){return new a(this.min.x+(this.max.x-this.min.x)/2,this.min.y+(this.max.y-this.min.y)/2)}static computeFromVertices(e){if(0==e.length)return new h(new a(0,0),new a(0,0));let t,s=e[0].x,i=e[0].x,r=e[0].y,n=e[0].y;for(var o in e)t=e[o],s=Math.min(s,t.x),i=Math.max(i,t.x),r=Math.min(r,t.y),n=Math.max(n,t.y);return new h(new a(s,r),new a(i,n))}}class l{constructor(e,t,s){this.uid=i.next(),this.a=e,this.b=t,this.factory=s}length(){return Math.sqrt(Math.pow(this.b.x-this.a.x,2)+Math.pow(this.b.y-this.a.y,2))}setLength(e){return this.scale(e/this.length())}sub(e){return this.a.sub(e),this.b.sub(e),this}add(e){return this.a.add(e),this.b.add(e),this}normalize(){return this.b.set(this.a.x+(this.b.x-this.a.x)/this.length(),this.a.y+(this.b.y-this.a.y)/this.length()),this}scale(e){return this.b.set(this.a.x+(this.b.x-this.a.x)*e,this.a.y+(this.b.y-this.a.y)*e),this}moveTo(e){let t=this.a.difference(e);return this.a.add(t),this.b.add(t),this}angle(e){null!=e&&void 0!==e||(e=this.factory(new a(0,0),new a(100,0)));const t=this.b.clone().sub(this.a),s=e.b.clone().sub(e.a);return Math.atan2(s.x,s.y)-Math.atan2(t.x,t.y)}vertAt(e){return new a(this.a.x+(this.b.x-this.a.x)*e,this.a.y+(this.b.y-this.a.y)*e)}denominator(e){return(e.b.y-e.a.y)*(this.b.x-this.a.x)-(e.b.x-e.a.x)*(this.b.y-this.a.y)}colinear(e){return Math.abs(this.denominator(e))<a.EPSILON}getClosestT(e){var t=l.vtutils.dist2(this.a,this.b);return 0===t?0:((e.x-this.a.x)*(this.b.x-this.a.x)+(e.y-this.a.y)*(this.b.y-this.a.y))/t}hasPoint(e,t){const s=this.getClosestT(e);if(void 0!==t&&t){return Math.sqrt(l.vtutils.dist2(e,this.vertAt(s)))<a.EPSILON&&s>=0&&s<=1}return s>=0&&s<=1}getClosestPoint(e){var t=this.getClosestT(e);return this.vertAt(t)}pointDistance(e){return Math.sqrt(l.vtutils.dist2(e,this.vertAt(this.getClosestT(e))))}clone(){return this.factory(this.a.clone(),this.b.clone())}toString(){return"{ a : "+this.a.toString()+", b : "+this.b.toString()+" }"}}l.vtutils={dist2:(e,t)=>(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)};class c extends l{constructor(e,t){super(e,t,((e,t)=>new c(e,t))),this.className="Vector"}perp(){var e=this.clone();return e.sub(this.a),(e=new c(new a,new a(-e.b.y,e.b.x))).a.add(this.a),e.b.add(this.a),e}inverse(){var e=this.a;return this.a=this.b,this.b=e,this}inv(){return this.b.x=this.a.x-(this.b.x-this.a.x),this.b.y=this.a.y-(this.b.y-this.a.y),this}intersection(e){var t=this.denominator(e);if(0==t)return null;var s=this.a.y-e.a.y,i=this.a.x-e.a.x,r=(e.b.x-e.a.x)*s-(e.b.y-e.a.y)*i,n=(this.b.x-this.a.x)*s-(this.b.y-this.a.y)*i;return s=r/t,i=n/t,new a(this.a.x+s*(this.b.x-this.a.x),this.a.y+s*(this.b.y-this.a.y))}toSVGString(e){e=e||{};var t=[],s=c.utils.buildArrowHead(this.a,this.b,8,1,1);t.push("<g"),e.className&&t.push(' class="'+e.className+'"'),t.push(">"),t.push("   <line"),t.push(' x1="'+this.a.x+'"'),t.push(' y1="'+this.a.y+'"'),t.push(' x2="'+s[0].x+'"'),t.push(' y2="'+s[0].y+'"'),t.push(" />"),t.push('   <polygon points="');for(var i=0;i<s.length;i++)i>0&&t.push(" "),t.push(s[i].x+","+s[i].y);return t.push('"/>'),t.push("</g>"),t.join("")}}c.utils={buildArrowHead:(e,t,s,i,r)=>{var n=Math.atan2((t.y-e.y)*r,(t.x-e.x)*i),o=[];return o.push(new a(t.x*i-s*Math.cos(n),t.y*r-s*Math.sin(n))),o.push(new a(t.x*i-1.35*s*Math.cos(n-Math.PI/8),t.y*r-1.35*s*Math.sin(n-Math.PI/8))),o.push(new a(t.x*i,t.y*r)),o.push(new a(t.x*i-1.35*s*Math.cos(n+Math.PI/8),t.y*r-1.35*s*Math.sin(n+Math.PI/8))),o}};class u{constructor(e,t,s,r){this.START_POINT=u.START_POINT,this.START_CONTROL_POINT=u.START_CONTROL_POINT,this.END_CONTROL_POINT=u.END_CONTROL_POINT,this.END_POINT=u.END_POINT,this.uid=i.next(),this.startPoint=e,this.startControlPoint=s,this.endPoint=t,this.endControlPoint=r,this.curveIntervals=30,this.segmentCache=[],this.segmentLengths=[],this.arcLength=null,this.updateArcLengths()}moveCurvePoint(e,t,s,i){e==this.START_POINT?(this.getStartPoint().add(t),s&&this.getStartControlPoint().add(t)):e==this.START_CONTROL_POINT?this.getStartControlPoint().add(t):e==this.END_CONTROL_POINT?this.getEndControlPoint().add(t):e==this.END_POINT?(this.getEndPoint().add(t),s&&this.getEndControlPoint().add(t)):console.log(`[CubicBezierCurve.moveCurvePoint] pointID '${e}' invalid.`),i&&this.updateArcLengths()}translate(e){return this.startPoint.add(e),this.startControlPoint.add(e),this.endControlPoint.add(e),this.endPoint.add(e),this}reverse(){let e=this.startPoint;return this.startPoint=this.endPoint,this.endPoint=e,e=this.startControlPoint,this.startControlPoint=this.endControlPoint,this.endControlPoint=e,this}getLength(){return this.arcLength}updateArcLengths(){let e=this.startPoint.clone(),t=new a(0,0),s=1/this.curveIntervals;this.segmentCache=[],this.segmentCache.push(this.startPoint),this.segmentLengths=[];let i=0;var r=0;let n;for(;r<=1;)t=this.getPointAt(r),this.segmentCache.push(t),n=e.distance(t),this.segmentLengths.push(n),i+=n,e=t,r+=s;this.arcLength=i}getClosestT(e){var t={t:0,tPrev:0,tNext:1},s=0;do{t=this.locateIntervalByDistance(e,t.tPrev,t.tNext,this.curveIntervals),s++}while(s<4&&this.getPointAt(t.tPrev).distance(this.getPointAt(t.tNext))>1);return t.t}locateIntervalByDistance(e,t,s,i){var r=-1,n=0,a=0;const o=s-t;for(var h=0;h<=i;h++){a=t+o*(h/i);var l=this.getPointAt(a).distance(e);(-1==r||l<n)&&(r=h,n=l)}return{t:t+o*(r/i),tPrev:t+o*(Math.max(0,r-1)/i),tNext:t+o*(Math.min(i,r+1)/i)}}getBounds(){var e=new a(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),t=new a(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);let s;for(var i=0;i<this.segmentCache.length;i++)s=this.segmentCache[i],e.x=Math.min(e.x,s.x),e.y=Math.min(e.y,s.y),t.x=Math.max(t.x,s.x),t.y=Math.max(t.y,s.y);return new h(e,t)}getStartPoint(){return this.startPoint}getEndPoint(){return this.endPoint}getStartControlPoint(){return this.startControlPoint}getEndControlPoint(){return this.endControlPoint}getPointByID(e){if(e==this.START_POINT)return this.startPoint;if(e==this.END_POINT)return this.endPoint;if(e==this.START_CONTROL_POINT)return this.startControlPoint;if(e==this.END_CONTROL_POINT)return this.endControlPoint;throw new Error(`Invalid point ID '${e}'.`)}getPointAt(e){const t=this.startPoint.x*Math.pow(1-e,3)+3*this.startControlPoint.x*e*Math.pow(1-e,2)+3*this.endControlPoint.x*Math.pow(e,2)*(1-e)+this.endPoint.x*Math.pow(e,3),s=this.startPoint.y*Math.pow(1-e,3)+3*this.startControlPoint.y*e*Math.pow(1-e,2)+3*this.endControlPoint.y*Math.pow(e,2)*(1-e)+this.endPoint.y*Math.pow(e,3);return new a(t,s)}getPoint(e){return this.getPointAt(e/this.arcLength)}getTangentAt(e){const t=this.getStartPoint(),s=this.getStartControlPoint(),i=this.getEndControlPoint(),r=this.getEndPoint(),n=e*e,o=1-2*e+n,h=-3*t.x*o+s.x*(3*o-6*(e-n))+i.x*(6*(e-n)-3*n)+3*r.x*n,l=-3*t.y*o+s.y*(3*o-6*(e-n))+i.y*(6*(e-n)-3*n)+3*r.y*n;return new a(h,l)}getSubCurveAt(e,t){const s=new c(this.getPointAt(e),this.getTangentAt(e)),i=new c(this.getPointAt(t),this.getTangentAt(t).inv());return s.b.add(s.a),i.b.add(i.a),s.scale(.33333333*(t-e)),i.scale(.33333333*(t-e)),new u(s.a,i.a,s.b,i.b)}convertU2T(e){return Math.max(0,Math.min(1,e/this.arcLength))}getTangent(e){return this.getTangentAt(this.convertU2T(e))}getPerpendicular(e){return this.getPerpendicularAt(this.convertU2T(e))}getPerpendicularAt(e){const t=this.getTangentAt(e);return new a(t.y,-t.x)}clone(){return new u(this.getStartPoint().clone(),this.getEndPoint().clone(),this.getStartControlPoint().clone(),this.getEndControlPoint().clone())}equals(e){return!!e&&(!!(e.startPoint&&e.endPoint&&e.startControlPoint&&e.endControlPoint)&&(this.startPoint.equals(e.startPoint)&&this.endPoint.equals(e.endPoint)&&this.startControlPoint.equals(e.startControlPoint)&&this.endControlPoint.equals(e.endControlPoint)))}static isInstance(e){return e instanceof u}toSVGPathData(){var e=[];return e.push("M "),e.push(this.startPoint.x.toString()),e.push(" "),e.push(this.startPoint.y.toString()),e.push(" C "),e.push(this.startControlPoint.x.toString()),e.push(" "),e.push(this.startControlPoint.y.toString()),e.push(" "),e.push(this.endControlPoint.x.toString()),e.push(" "),e.push(this.endControlPoint.y.toString()),e.push(" "),e.push(this.endPoint.x.toString()),e.push(" "),e.push(this.endPoint.y.toString()),e.join("")}toJSON(e){return"{ "+(e?"\n\t":"")+'"startPoint" : ['+this.getStartPoint().x+","+this.getStartPoint().y+"], "+(e?"\n\t":"")+'"endPoint" : ['+this.getEndPoint().x+","+this.getEndPoint().y+"], "+(e?"\n\t":"")+'"startControlPoint": ['+this.getStartControlPoint().x+","+this.getStartControlPoint().y+"], "+(e?"\n\t":"")+'"endControlPoint" : ['+this.getEndControlPoint().x+","+this.getEndControlPoint().y+"]"+(e?"\n\t":"")+" }"}static fromJSON(e){var t=JSON.parse(e);return u.fromObject(t)}static fromObject(e){if("object"!=typeof e)throw"Can only build from object.";if(!e.startPoint)throw'Object member "startPoint" missing.';if(!e.endPoint)throw'Object member "endPoint" missing.';if(!e.startControlPoint)throw'Object member "startControlPoint" missing.';if(!e.endControlPoint)throw'Object member "endControlPoint" missing.';return new u(new a(e.startPoint[0],e.startPoint[1]),new a(e.endPoint[0],e.endPoint[1]),new a(e.startControlPoint[0],e.startControlPoint[1]),new a(e.endControlPoint[0],e.endControlPoint[1]))}static fromArray(e){if(!Array.isArray(e))throw"Can only build from object.";if(4!=e.length)throw"Can only build from array with four elements.";return new u(e[0],e[1],e[2],e[3])}}u.START_POINT=0,u.START_CONTROL_POINT=1,u.END_CONTROL_POINT=2,u.END_POINT=3;class d{constructor(e){this.className="BezierPath",this.START_POINT=0,this.START_CONTROL_POINT=1,this.END_CONTROL_POINT=2,this.END_POINT=3,this.uid=i.next(),e||(e=[]),this.totalArcLength=0,this.adjustCircular=!1,this.bezierCurves=[]}addCurve(e){if(null==e||void 0===e)throw"Cannot add null curve to bzier path.";this.bezierCurves.push(e),this.bezierCurves.length>1?(e.startPoint=this.bezierCurves[this.bezierCurves.length-2].endPoint,this.adjustSuccessorControlPoint(this.bezierCurves.length-2,!0,!0)):this.totalArcLength+=e.getLength()}locateCurveByStartPoint(e){for(var t=0;t<this.bezierCurves.length;t++)if(this.bezierCurves[t].startPoint.equals(e))return t;return-1}locateCurveByEndPoint(e){for(var t=0;t<this.bezierCurves.length;t++)if(this.bezierCurves[t].endPoint.equals(e))return t;return-1}locateCurveByStartControlPoint(e){for(var t=0;t<this.bezierCurves.length;t++)if(this.bezierCurves[t].startControlPoint.equals(e))return t;return-1}locateCurveByEndControlPoint(e){for(var t=0;t<this.bezierCurves.length;t++)if(this.bezierCurves[t].endControlPoint.equals(e))return t;return-1}getLength(){return this.totalArcLength}updateArcLengths(){this.totalArcLength=0;for(var e=0;e<this.bezierCurves.length;e++)this.bezierCurves[e].updateArcLengths(),this.totalArcLength+=this.bezierCurves[e].getLength()}getCurveCount(){return this.bezierCurves.length}getCurveAt(e){return this.bezierCurves[e]}translate(e){for(var t=0;t<this.bezierCurves.length;t++){(s=this.bezierCurves[t]).getStartPoint().add(e),s.getStartControlPoint().add(e),s.getEndControlPoint().add(e)}var s;return(s=this.bezierCurves[this.bezierCurves.length-1]).getEndPoint().add(e),this.updateArcLengths(),this}scale(e,t){for(var s=0;s<this.bezierCurves.length;s++){var i=this.bezierCurves[s];i.getStartPoint().scale(t,e),i.getStartControlPoint().scale(t,e),i.getEndControlPoint().scale(t,e)}return this.bezierCurves.length>0&&!this.adjustCircular&&this.bezierCurves[this.bezierCurves.length-1].getEndPoint().scale(t,e),this.updateArcLengths(),this}rotate(e,t){for(var s=0;s<this.bezierCurves.length;s++){var i=this.bezierCurves[s];i.getStartPoint().rotate(e,t),i.getStartControlPoint().rotate(e,t),i.getEndControlPoint().rotate(e,t)}this.bezierCurves.length>0&&!this.adjustCircular&&this.bezierCurves[this.bezierCurves.length-1].getEndPoint().rotate(e,t)}getClosestT(e){for(var t=-1,s=0,i=0,r=0,n=0,a=0,o=0;o<this.bezierCurves.length;o++)r=this.bezierCurves[o].getClosestT(e),i=this.bezierCurves[o].getPointAt(r).distance(e),(-1==t||i<s)&&(t=o,s=i,n=a+r*this.bezierCurves[o].getLength()),a+=this.bezierCurves[o].getLength();return Math.max(0,Math.min(1,n/this.totalArcLength))}getPoint(e){(e<0||e>this.totalArcLength)&&(console.warn("[BezierPath.getPoint(u)] u is out of bounds: "+e+"."),e=Math.min(this.totalArcLength,Math.max(e,0)));for(var t=0,s=0;t<this.bezierCurves.length&&s+this.bezierCurves[t].getLength()<e;)s+=this.bezierCurves[t].getLength(),t++;if(t>=this.bezierCurves.length)return this.bezierCurves[this.bezierCurves.length-1].getEndPoint().clone();var i=e-s;return this.bezierCurves[t].getPoint(i)}getPointAt(e){return this.getPoint(e*this.totalArcLength)}getTangentAt(e){return this.getTangent(e*this.totalArcLength)}getTangent(e){(e<0||e>this.totalArcLength)&&(console.warn("[BezierPath.getTangent(u)] u is out of bounds: "+e+"."),e=Math.min(this.totalArcLength,Math.max(0,e)));for(var t=0,s=0;t<this.bezierCurves.length&&s+this.bezierCurves[t].getLength()<e;)s+=this.bezierCurves[t].getLength(),t++;var i=e-s;return this.bezierCurves[t].getTangent(i)}getPerpendicularAt(e){return this.getPerpendicular(e*this.totalArcLength)}getPerpendicular(e){(e<0||e>this.totalArcLength)&&(console.log("[BezierPath.getPerpendicular(u)] u is out of bounds: "+e+"."),e=Math.min(this.totalArcLength,Math.max(0,e)));var t=d._locateUIndex(this,e),s=this.bezierCurves[t.i],i=e-t.uPart;return s.getPerpendicular(i)}static _locateUIndex(e,t){for(var s=0,i=0,r=0;s<e.bezierCurves.length&&i+e.bezierCurves[s].getLength()<t;)i+=e.bezierCurves[s].getLength(),s+1<e.bezierCurves.length&&(r+=e.bezierCurves[s].getLength()),s++;return{i:s,uPart:i,uBefore:r}}getSubPathAt(e,t){e=Math.max(0,e),t=Math.min(1,t);let s=e*this.totalArcLength,i=t*this.totalArcLength;var r=d._locateUIndex(this,s),n=d._locateUIndex(this,i),a=(s-r.uBefore)/this.bezierCurves[r.i].getLength();if(r.i==n.i){var o=(i-n.uBefore)/this.bezierCurves[n.i].getLength(),h=this.bezierCurves[r.i].getSubCurveAt(a,o);return d.fromArray([h])}var l=[];if(r.i>n.i){h=this.bezierCurves[r.i].getSubCurveAt(a,0);l.push(h);for(var c=r.i-1;c>n.i;c--)l.push(this.bezierCurves[c].clone().reverse());o=(i-n.uBefore)/this.bezierCurves[n.i].getLength();l.push(this.bezierCurves[n.i].getSubCurveAt(1,o))}else{h=this.bezierCurves[r.i].getSubCurveAt(a,1);l.push(h);for(c=r.i+1;c<n.i&&c<this.bezierCurves.length;c++)l.push(this.bezierCurves[c].clone());o=(i-n.uBefore)/this.bezierCurves[n.i].getLength();l.push(this.bezierCurves[n.i].getSubCurveAt(0,o))}return d.fromArray(l)}moveCurvePoint(e,t,s){if(this.getCurveAt(e).moveCurvePoint(t,s,!0,!0),t==this.START_POINT&&(e>0||this.adjustCircular))this.getCurveAt(e-1<0?this.bezierCurves.length+(e-1):e-1).moveCurvePoint(this.END_CONTROL_POINT,s,!0,!1);else if(t==this.END_POINT&&(e+1<this.bezierCurves.length||this.adjustCircular)){this.getCurveAt((e+1)%this.bezierCurves.length).moveCurvePoint(this.START_CONTROL_POINT,s,!0,!1)}else t==this.START_CONTROL_POINT&&e>0?this.adjustPredecessorControlPoint(e,!0,!1):t==this.END_CONTROL_POINT&&e+1<this.getCurveCount()&&this.adjustSuccessorControlPoint(e,!0,!1);this.updateArcLengths()}adjustPredecessorControlPoint(e,t,s){if(this.adjustCircular||!(e<=0)){var i=this.getCurveAt(e),r=this.getCurveAt(e-1<0?this.getCurveCount()+(e-1):e-1);d.adjustNeighbourControlPoint(i,r,i.getStartPoint(),i.getStartControlPoint(),r.getEndPoint(),r.getEndControlPoint(),t,s)}}adjustSuccessorControlPoint(e,t,s){if(this.adjustCircular||!(e+1>this.getCurveCount())){var i=this.getCurveAt(e),r=this.getCurveAt((e+1)%this.getCurveCount());d.adjustNeighbourControlPoint(i,r,i.getEndPoint(),i.getEndControlPoint(),r.getStartPoint(),r.getStartControlPoint(),t,s)}}static adjustNeighbourControlPoint(e,t,s,i,r,n,o,h){var l=new a(i.x-s.x,i.y-s.y),c=new a(n.x-r.x,n.y-r.y),u=Math.sqrt(Math.pow(l.x,2)+Math.pow(l.y,2)),d=Math.sqrt(Math.pow(c.x,2)+Math.pow(c.y,2));u<=.1||(o?n.set(r.x-l.x*(d/u),r.y-l.y*(d/u)):n.set(r.x-l.x,r.y-l.y),t.updateArcLengths())}getBounds(){const e=new a(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),t=new a(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(var s,i=0;i<this.bezierCurves.length;i++)s=this.bezierCurves[i].getBounds(),e.x=Math.min(e.x,s.min.x),e.y=Math.min(e.y,s.min.y),t.x=Math.max(t.x,s.max.x),t.y=Math.max(t.y,s.max.y);return new h(e,t)}clone(){for(var e=new d(void 0),t=0;t<this.bezierCurves.length;t++)e.bezierCurves.push(this.bezierCurves[t].clone()),t>0&&(e.bezierCurves[t-1].endPoint=e.bezierCurves[t].startPoint);return e.updateArcLengths(),e.adjustCircular=this.adjustCircular,e}equals(e){if(!e)return!1;if(!e.bezierCurves)return!1;if(void 0===e.bezierCurves.length)return!1;if(e.bezierCurves.length!=this.bezierCurves.length)return!1;for(var t=0;t<this.bezierCurves.length;t++)if(!this.bezierCurves[t].equals(e.bezierCurves[t]))return!1;return!0}toSVGString(e){e=e||{};var t=[];t.push("<path"),e.className&&t.push(' class="'+e.className+'"'),t.push(' d="');for(var s=0;s<this.bezierCurves.length;s++)s>0&&t.push(" "),t.push(this.bezierCurves[s].toSVGPathData());return t.push('" />'),t.join("")}toJSON(e){var t=[];t.push("[");for(var s=0;s<this.bezierCurves.length;s++)s>0&&t.push(","),e?t.push("\n\t"):t.push(" "),t.push(this.bezierCurves[s].toJSON(e));return 0!=this.bezierCurves.length&&t.push(" "),t.push("]"),t.join("")}static fromJSON(e){var t=JSON.parse(e);return d.fromArray(t)}static fromArray(e){if(!Array.isArray(e))throw"[BezierPath.fromArray] Passed object must be an array.";const t=e;if(t.length<1)throw"[BezierPath.fromArray] Passed array must contain at least one bezier curve (has "+t.length+").";for(var s=new d(void 0),i=null,r=0;r<t.length;r++){var n;if(u.isInstance(t[r]))n=t[r].clone();else if(0 in t[r]&&1 in t[r]&&2 in t[r]&&3 in t[r]){if(!(t[r][0]&&t[r][1]&&t[r][2]&&t[r][3]))throw"Cannot convert path data to BezierPath instance. At least one element is undefined (index="+r+"): "+t[r];n=u.fromArray(t[r])}else n=u.fromObject(t[r]);i&&(n.startPoint=i.endPoint),s.bezierCurves.push(n),i=n}return s.updateArcLengths(),s}toReducedListRepresentation(e){void 0===e&&(e=1);var t=[];t.push("[");for(var s=0;s<this.bezierCurves.length;s++){var i=this.bezierCurves[s];t.push(i.getStartPoint().x.toFixed(e)),t.push(","),t.push(i.getStartPoint().y.toFixed(e)),t.push(","),t.push(i.getStartControlPoint().x.toFixed(e)),t.push(","),t.push(i.getStartControlPoint().y.toFixed(e)),t.push(","),t.push(i.getEndControlPoint().x.toFixed(e)),t.push(","),t.push(i.getEndControlPoint().y.toFixed(e)),t.push(",")}if(0!=this.bezierCurves.length){i=this.bezierCurves[this.bezierCurves.length-1];t.push(i.getEndPoint().x.toFixed(e)),t.push(","),t.push(i.getEndPoint().y.toFixed(e))}return t.push("]"),t.join("")}static fromReducedListRepresentation(e,t){var s=JSON.parse(e);if(!s.length)throw console.log("Cannot parse bezier path from non-array object nor from empty point list."),"Cannot parse bezier path from non-array object nor from empty point list.";if(s.length<8)throw console.log("Cannot build bezier path. The passed array must contain at least 8 elements (numbers)."),"Cannot build bezier path. The passed array must contain at least 8 elements (numbers).";return d.fromReducedList(s,t)}static fromReducedList(e,t){var s,i,r,n,o=new d(null),h=0;do{0==h&&(s=new a(e[h],e[h+1])),i=new a(e[h+2],e[h+3]),r=new a(e[h+4],e[h+5]),n=new a(e[h+6],e[h+7]);var l=new u(s,n,i,r);o.bezierCurves.push(l),s=n,h+=6}while(h+2<e.length);return o.adjustCircular=t,t&&(o.bezierCurves[o.bezierCurves.length-1].endPoint=o.bezierCurves[0].startPoint),o.updateArcLengths(),o}}d.START_POINT=0,d.START_CONTROL_POINT=1,d.END_CONTROL_POINT=2,d.END_POINT=3;class f extends l{constructor(e,t){super(e,t,((e,t)=>new f(e,t))),this.className="Line"}intersection(e){const t=this.denominator(e);if(0==t)return null;let s=this.a.y-e.a.y,i=this.a.x-e.a.x;const r=(e.b.x-e.a.x)*s-(e.b.y-e.a.y)*i,n=(this.b.x-this.a.x)*s-(this.b.y-this.a.y)*i;s=r/t,i=n/t;const o=this.a.x+s*(this.b.x-this.a.x),h=this.a.y+s*(this.b.y-this.a.y);return isNaN(s)||isNaN(o)||isNaN(h)?void 0:new a(o,h)}toSVGString(e){e=e||{};var t=[];return t.push("<line"),e.className&&t.push(' class="'+e.className+'"'),t.push(' x1="'+this.a.x+'"'),t.push(' y1="'+this.a.y+'"'),t.push(' x2="'+this.b.x+'"'),t.push(' y2="'+this.b.y+'"'),t.push(" />"),t.join("")}}class g{constructor(e,t){this.className="Circle",this.uid=i.next(),this.center=e,this.radius=t}containsCircle(e){return this.center.distance(e.center)+e.radius<this.radius}lineDistance(e){return e.getClosestPoint(this.center).distance(this.center)-this.radius}vertAt(e){return g.circleUtils.vertAt(e,this.radius).add(this.center)}tangentAt(e){const t=g.circleUtils.vertAt(e,this.radius);return new c(t,new a(0,0)).add(this.center).perp()}circleIntersection(e){if(this.center.distance(e.center)>this.radius+e.radius)return null;if(this.center.distance(e.center)<Math.abs(this.radius-e.radius))return null;var t=this.center,s=e.center,i=t.distance(s),r=(this.radius*this.radius-e.radius*e.radius+i*i)/(2*i),n=Math.sqrt(this.radius*this.radius-r*r),o=s.clone().scale(r/i,t),h=o.x+n*(s.y-t.y)/i,l=o.y-n*(s.x-t.x)/i,c=o.x-n*(s.y-t.y)/i,u=o.y+n*(s.x-t.x)/i;return new f(new a(h,l),new a(c,u))}toSVGString(e){e=e||{};var t=[];return t.push("<circle"),e.className&&t.push(' class="'+e.className+'"'),t.push(' cx="'+this.center.x+'"'),t.push(' cy="'+this.center.y+'"'),t.push(' r="'+this.radius+'"'),t.push(" />"),t.join("")}}g.circleUtils={vertAt:(e,t)=>new a(Math.cos(e)*t,Math.sin(e)*t)};class v{constructor(e,t,s){this.className="CircleSector",this.uid=i.next(),this.circle=e,this.startAngle=t,this.endAngle=s}toSVGString(e){e=e||{};var t=[];t.push("<path "),e.className&&t.push(' class="'+e.className+'"');const s=v.circleSectorUtils.describeSVGArc(this.circle.center.x,this.circle.center.y,this.circle.radius,this.startAngle,this.endAngle);return t.push(' d="'+s.join(" ")+'" />'),t.join("")}}v.circleSectorUtils={polarToCartesian:(e,t,s,i)=>({x:e+s*Math.cos(i),y:t+s*Math.sin(i)}),describeSVGArc:(e,t,s,i,r,n)=>{void 0===n&&(n={moveToStart:!0});const a=v.circleSectorUtils.polarToCartesian(e,t,s,r),o=v.circleSectorUtils.polarToCartesian(e,t,s,i);if(2*Math.PI-Math.abs(i-r)<.001){const a=v.circleSectorUtils.describeSVGArc(e,t,s,i,i+(r-i)/2,n),o=v.circleSectorUtils.describeSVGArc(e,t,s,i+(r-i)/2,r,n);return a.concat(o)}const h=r-i;var l,c;h<0?(l=Math.abs(h)<Math.PI?1:0,c=1):(l=Math.abs(h)>Math.PI?1:0,c=1);const u=[];return n.moveToStart&&u.push("M",o.x,o.y),u.push("A",s,s,0,l,c,a.x,a.y),u}};class p{constructor(e,t,s,i,r,n,o,h,l){this.svgNode=e,this.offset=new a(0,0).set(t),this.scale=new a(1,1).set(s),this.fillShapes=r,this.isSecondary=o,this.drawlibConfiguration={},this.cache=new Map,this.setSize(i),o?(this.gNode=h,this.bufferGNode=l):(this.addStyleDefs(n),this.gNode=this.createSVGNode("g"),this.bufferGNode=this.createSVGNode("g"),this.svgNode.appendChild(this.gNode))}addStyleDefs(e){this.nodeStyle=this.createSVGNode("style"),this.svgNode.appendChild(this.nodeStyle);const t={polygon:"Polygon",triangle:"Triangle",ellipse:"Ellipse",ellipseSector:"EllipseSector",circle:"Circle",circleSector:"CircleSector",vertex:"Vertex",line:"Line",vector:"Vector",image:"Image"},s=[];for(var i in t){const r=t[i],n=e[i];n?s.push(`.${r} { fill : none; stroke: ${n.color}; stroke-width: ${n.lineWidth}px }`):console.warn(`Warning: your draw config is missing the key '${i}' which is required.`)}this.nodeStyle.innerHTML=s.join("\n")}addCustomStyleDefs(e){const t=[];e.forEach(((e,s)=>{t.push(s+" { "+e+" }")})),this.nodeStyle.innerHTML+="\n/* Custom styles */\n"+t.join("\n")}findElement(e,t){var s=this.cache.get(e);return s&&s.nodeName.toUpperCase()===t.toUpperCase()?(this.cache.delete(e),s):null}createSVGNode(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}makeNode(e){var t=this.findElement(this.curId,e);return t||(t=this.createSVGNode(e)),this.drawlibConfiguration.blendMode&&(t.style["mix-blend-mode"]=this.drawlibConfiguration.blendMode),t}_bindFillDraw(e,t,s,i){return this.curClassName?e.setAttribute("class",`${t} ${this.curClassName}`):e.setAttribute("class",t),e.setAttribute("fill",this.fillShapes?s:"none"),e.setAttribute("stroke",this.fillShapes?"none":s),e.setAttribute("stroke-width",`${i||1}`),this.curId&&e.setAttribute("id",`${this.curId}`),e.parentNode||this.bufferGNode.appendChild(e),e}setSize(e){this.canvasSize=e,this.svgNode.setAttribute("viewBox",`0 0 ${this.canvasSize.width} ${this.canvasSize.height}`),this.svgNode.setAttribute("width",`${this.canvasSize.width}`),this.svgNode.setAttribute("height",`${this.canvasSize.height}`)}copyInstance(e){return new p(this.svgNode,this.offset,this.scale,this.canvasSize,e,null,!0,this.gNode,this.bufferGNode)}setConfiguration(e){this.drawlibConfiguration=e}setCurrentId(e){this.curId=e}setCurrentClassName(e){this.curClassName=e}beginDrawCycle(e){this.cache.clear();for(var t=0;t<this.bufferGNode.childNodes.length;t++){var s=this.bufferGNode.childNodes[t];this.cache.set(s.getAttribute("id"),s)}this.removeAllChildNodes()}endDrawCycle(e){this.isSecondary||this.svgNode.replaceChild(this.bufferGNode,this.gNode);let t=this.gNode;this.gNode=this.bufferGNode,this.bufferGNode=t}_x(e){return this.offset.x+this.scale.x*e}_y(e){return this.offset.y+this.scale.y*e}line(e,t,s,i){const r=this.makeNode("line");return r.setAttribute("x1",`${this._x(e.x)}`),r.setAttribute("y1",`${this._y(e.y)}`),r.setAttribute("x2",`${this._x(t.x)}`),r.setAttribute("y2",`${this._y(t.y)}`),this._bindFillDraw(r,"line",s,i||1)}arrow(e,t,s,i){const r=this.makeNode("path");var n=a.utils.buildArrowHead(e,t,8,this.scale.x,this.scale.y);const o=["M",this._x(e.x),this._y(e.y)];for(var h=0;h<=n.length;h++)o.push("L"),o.push(this.offset.x+n[h%n.length].x),o.push(this.offset.y+n[h%n.length].y);return r.setAttribute("d",o.join(" ")),this._bindFillDraw(r,"arrow",s,i||1)}image(e,t,s){const i=this.makeNode("image"),r=e=>{if(e.naturalWidth){const r=s.x/e.naturalWidth,n=s.y/e.naturalHeight;i.setAttribute("width",""+e.naturalWidth*this.scale.x),i.setAttribute("height",""+e.naturalHeight*this.scale.y),i.setAttribute("display",null),i.setAttribute("transform",`translate(${this._x(t.x)} ${this._y(t.y)}) scale(${r} ${n})`)}};return e.addEventListener("load",(t=>{r(e)})),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("display","none"),r(e),i.setAttribute("href",e.src),this._bindFillDraw(i,"image",null,null)}cubicBezier(e,t,s,i,r,n){if(e instanceof u)return this.cubicBezier(e.startPoint,e.endPoint,e.startControlPoint,e.endControlPoint,r,n);const a=this.makeNode("path"),o=["M",this._x(e.x),this._y(e.y),"C",this._x(s.x),this._y(s.y),this._x(i.x),this._y(i.y),this._x(t.x),this._y(t.y)];return a.setAttribute("d",o.join(" ")),this._bindFillDraw(a,"cubierBezier",r,n)}cubicBezierPath(e,t,s){const i=this.makeNode("path");if(!e||0==e.length)return i;const r=["M",this._x(e[0].x),this._y(e[0].y)];for(var n,a,o,h=1;h<e.length;h+=3)a=e[h],o=e[h+1],n=e[h+2],r.push("C",this._x(a.x),this._y(a.y),this._x(o.x),this._y(o.y),this._x(n.x),this._y(n.y));return i.setAttribute("d",r.join(" ")),this._bindFillDraw(i,"cubicBezierPath",t,s||1)}handle(e,t){this.point(e,"rgb(0,32,192)"),this.square(t,5,"rgba(0,128,192,0.5)")}handleLine(e,t){this.line(e,t,"rgb(192,192,192)")}dot(e,t){const s=this.makeNode("line");return this._bindFillDraw(s,"dot",t,1)}point(e,t){const s=this.makeNode("circle");return s.setAttribute("cx",`${this._x(e.x)}`),s.setAttribute("cy",`${this._y(e.y)}`),s.setAttribute("r","3"),this._bindFillDraw(s,"point",t,1)}circle(e,t,s,i){const r=this.makeNode("circle");return r.setAttribute("cx",`${this._x(e.x)}`),r.setAttribute("cy",`${this._y(e.y)}`),r.setAttribute("r",""+t*this.scale.x),this._bindFillDraw(r,"circle",s,i||1)}circleArc(e,t,s,i,r,n){const a=this.makeNode("path"),o=v.circleSectorUtils.describeSVGArc(this._x(e.x),this._y(e.y),t*this.scale.x,s,i);return a.setAttribute("d",o.join(" ")),this._bindFillDraw(a,"circleArc",r,n||1)}ellipse(e,t,s,i,r,n){void 0===n&&(n=0);const a=this.makeNode("ellipse");return a.setAttribute("cx",`${this._x(e.x)}`),a.setAttribute("cy",`${this._y(e.y)}`),a.setAttribute("rx",""+t*this.scale.x),a.setAttribute("ry",""+s*this.scale.y),a.setAttribute("transform",`rotate(${180*n/Math.PI} ${this._x(e.x)} ${this._y(e.y)})`),this._bindFillDraw(a,"ellipse",i,r||1)}square(e,t,s,i){const r=this.makeNode("rectangle");return r.setAttribute("x",`${this._x(e.x-t/2)}`),r.setAttribute("y",`${this._y(e.y-t/2)}`),r.setAttribute("width",""+t*this.scale.x),r.setAttribute("height",""+t*this.scale.y),this._bindFillDraw(r,"square",s,i||1)}rect(e,t,s,i,r){const n=this.makeNode("rect");return n.setAttribute("x",`${this._x(e.x)}`),n.setAttribute("y",`${this._y(e.y)}`),n.setAttribute("width",""+t*this.scale.x),n.setAttribute("height",""+s*this.scale.y),this._bindFillDraw(n,"rect",i,r||1)}grid(e,t,s,i,r,n){const a=this.makeNode("path"),o=[];for(var h=-Math.ceil(.5*s/r)*r,l=s/2,c=-Math.ceil(.5*t/i)*i;c<t/2;c+=i)o.push("M",this._x(e.x+c),this._y(e.y+h)),o.push("L",this._x(e.x+c),this._y(e.y+l));for(var u=-Math.ceil(.5*t/i)*i,d=t/2,f=-Math.ceil(.5*s/r)*r;f<s/2;f+=r)o.push("M",this._x(e.x+u),this._y(e.y+f)),o.push("L",this._x(e.x+d),this._y(e.y+f));return a.setAttribute("d",o.join(" ")),this._bindFillDraw(a,"grid",n,1)}raster(e,t,s,i,r,n){const a=this.makeNode("path"),o=[];for(var h=-Math.ceil(.5*t/i)*i;h<t/2;h+=i)for(var l=-Math.ceil(.5*s/r)*r;l<s/2;l+=r)o.push("M",this._x(e.x+h)-4,this._y(e.y+l)),o.push("L",this._x(e.x+h)+4,this._y(e.y+l)),o.push("M",this._x(e.x+h),this._y(e.y+l)-4),o.push("L",this._x(e.x+h),this._y(e.y+l)+4);return a.setAttribute("d",o.join(" ")),this._bindFillDraw(a,"raster",n,1)}diamondHandle(e,t,s){const i=this.makeNode("path"),r=["M",this._x(e.x)-t/2,this._y(e.y),"L",this._x(e.x),this._y(e.y)-t/2,"L",this._x(e.x)+t/2,this._y(e.y),"L",this._x(e.x),this._y(e.y)+t/2,"Z"];return i.setAttribute("d",r.join(" ")),this._bindFillDraw(i,"diamondHandle",s,1)}squareHandle(e,t,s){const i=this.makeNode("rect");return i.setAttribute("x",""+(this._x(e.x)-t/2)),i.setAttribute("y",""+(this._y(e.y)-t/2)),i.setAttribute("width",`${t}`),i.setAttribute("height",`${t}`),this._bindFillDraw(i,"squareHandle",s,1)}circleHandle(e,t,s){t=t||3;const i=this.makeNode("circle");return i.setAttribute("cx",`${this._x(e.x)}`),i.setAttribute("cy",`${this._y(e.y)}`),i.setAttribute("r",`${t}`),this._bindFillDraw(i,"circleHandle",s,1)}crosshair(e,t,s){const i=this.makeNode("path"),r=["M",this._x(e.x)-t,this._y(e.y),"L",this._x(e.x)+t,this._y(e.y),"M",this._x(e.x),this._y(e.y)-t,"L",this._x(e.x),this._y(e.y)+t];return i.setAttribute("d",r.join(" ")),this._bindFillDraw(i,"crosshair",s,.5)}polygon(e,t,s){return this.polyline(e.vertices,e.isOpen,t,s)}polyline(e,t,s,i){const r=this.makeNode("path");if(0==e.length)return r;const n=["M",this._x(e[0].x),this._y(e[0].y)];for(var a=e.length,o=1;o<a;o++)n.push("L",this._x(e[o].x),this._y(e[o].y));return t||n.push("Z"),r.setAttribute("d",n.join(" ")),this._bindFillDraw(r,"polyline",s,i||1)}text(e,t,s,i){const r=(i=i||{}).color||"black",n=this.makeNode("text");return n.setAttribute("x",`${this._x(t)}`),n.setAttribute("y",`${this._y(s)}`),n.innerHTML=e,this._bindFillDraw(n,"text",r,1)}label(e,t,s,i){const r=this.makeNode("text");return r.setAttribute("transform",`translate(${this.offset.x},${this.offset.y}), rotate(${i/Math.PI*180})`),r.innerHTML=e,this._bindFillDraw(r,"label","black",null)}path(e,t,s,i){const r=this.makeNode("path"),n=i&&i.inplace?e:p.copyPathData(e);return p.transformPathData(n,this.offset,this.scale),r.setAttribute("d",n.join(" ")),this._bindFillDraw(r,"path",t,s)}clear(e){if(this.isSecondary)return;this.curId="background",this.curClassName=void 0;const t=this.makeNode("rect");t.setAttribute("x","0"),t.setAttribute("y","0"),t.setAttribute("width",`${this.canvasSize.width}`),t.setAttribute("height",`${this.canvasSize.height}`),this._bindFillDraw(t,this.curId,null,null),t.setAttribute("fill",void 0===e?"none":e),this.curId=void 0}removeAllChildNodes(){for(;this.bufferGNode.lastChild;)this.bufferGNode.removeChild(this.bufferGNode.lastChild)}static createSvg(){return document.createElementNS("http://www.w3.org/2000/svg","svg")}static copyPathData(e){const t=new Array(e.length);for(var s=0,i=e.length;s<i;s++)t[s]=e[s];return t}static transformPathData(e,t,s){const i=i=>{e[i]=t.x+s.x*Number(e[i])},r=i=>{e[i]=t.y+s.y*Number(e[i])},n=t=>{e[t]=s.x*Number(e[t])},a=t=>{e[t]=s.y*Number(e[t])};for(var o=0,h={x:NaN,y:NaN},l=t=>{h.x=Number(e[t]),h.y=Number(e[t+1])};o<e.length;){switch(e[o]){case"M":case"L":case"T":i(o+1),r(o+2),l(o+1),o+=3;break;case"m":case"l":case"t":n(o+1),a(o+2),l(o+1),o+=3;break;case"H":i(o+1),h.x=Number(e[o+1]),o+=2;break;case"h":n(o+1),h.x=Number(e[o+1]),o+=2;break;case"V":r(o+1),h.y=Number(e[o+1]),o+=2;break;case"v":a(o+1),h.y=Number(e[o+1]),o+=2;break;case"C":i(o+1),r(o+2),i(o+3),r(o+4),i(o+5),r(o+6),l(o+5),o+=7;break;case"c":n(o+1),a(o+2),n(o+3),a(o+4),n(o+5),a(o+6),l(o+5),o+=7;break;case"S":case"Q":i(o+1),r(o+2),i(o+3),r(o+4),l(o+3),o+=5;break;case"s":case"q":n(o+1),a(o+2),n(o+3),a(o+4),l(o+3),o+=5;break;case"A":n(o+1),a(o+2),i(o+6),r(o+7),l(o+6),(s.x<0&&s.y>=0||s.x>=0&&s.y<0)&&(e[o+5]=e[o+5]?0:1),o+=8;break;case"a":n(o+1),a(o+2),n(o+6),a(o+7),l(o+6),o+=8;break;default:o++}}}}p.HEAD_XML=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.0//EN" ','         "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">',""].join("\n");class m{constructor(e,t){this.ctx=e,this.offset=new a(0,0),this.scale=new a(1,1),this.fillShapes=t}beginDrawCycle(e){}endDrawCycle(e){}setConfiguration(e){this.ctx.globalCompositeOperation=e.blendMode}setCurrentId(e){}setCurrentClassName(e){}line(e,t,s,i){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y),this.ctx.lineTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.strokeStyle=s,this.ctx.lineWidth=i||1,this.ctx.stroke(),this.ctx.restore()}arrow(e,t,s,i){this.ctx.save(),this.ctx.beginPath();var r=a.utils.buildArrowHead(e,t,8,this.scale.x,this.scale.y);this.ctx.moveTo(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y);for(var n=0;n<r.length;n++)this.ctx.lineTo(this.offset.x+r[n].x,this.offset.y+r[n].y);this.ctx.lineTo(this.offset.x+r[0].x,this.offset.y+r[0].y),this.ctx.lineWidth=i||1,this._fillOrDraw(s),this.ctx.restore()}image(e,t,s){e.complete&&e.naturalWidth&&(this.ctx.save(),this.ctx.drawImage(e,0,0,e.naturalWidth-1,e.naturalHeight-1,this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,s.x*this.scale.x,s.y*this.scale.y),this.ctx.restore())}rect(e,t,s,i,r){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y),this.ctx.lineTo(this.offset.x+(e.x+t)*this.scale.x,this.offset.y+e.y*this.scale.y),this.ctx.lineTo(this.offset.x+(e.x+t)*this.scale.x,this.offset.y+(e.y+s)*this.scale.y),this.ctx.lineTo(this.offset.x+e.x*this.scale.x,this.offset.y+(e.y+s)*this.scale.y),this.ctx.closePath(),this.ctx.lineWidth=r||1,this._fillOrDraw(i),this.ctx.restore()}_fillOrDraw(e){this.fillShapes?(this.ctx.fillStyle=e,this.ctx.fill()):(this.ctx.strokeStyle=e,this.ctx.stroke())}cubicBezier(e,t,s,i,r,n){e instanceof u?this.cubicBezier(e.startPoint,e.endPoint,e.startControlPoint,e.endControlPoint,r,n):(this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y),this.ctx.bezierCurveTo(this.offset.x+s.x*this.scale.x,this.offset.y+s.y*this.scale.y,this.offset.x+i.x*this.scale.x,this.offset.y+i.y*this.scale.y,this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y),this.ctx.lineWidth=n||2,this._fillOrDraw(r),this.ctx.restore())}quadraticBezier(e,t,s,i,r){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y),this.ctx.quadraticCurveTo(this.offset.x+t.x*this.scale.x,this.offset.y+t.y*this.scale.y,this.offset.x+s.x*this.scale.x,this.offset.y+s.y*this.scale.y),this.ctx.lineWidth=r||2,this._fillOrDraw(i),this.ctx.restore()}cubicBezierPath(e,t,s){if(e&&0!=e.length){var i,r,n;this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+e[0].x*this.scale.x,this.offset.y+e[0].y*this.scale.y);for(var a=1;a<e.length;a+=3)r=e[a],n=e[a+1],i=e[a+2],this.ctx.bezierCurveTo(this.offset.x+r.x*this.scale.x,this.offset.y+r.y*this.scale.y,this.offset.x+n.x*this.scale.x,this.offset.y+n.y*this.scale.y,this.offset.x+i.x*this.scale.x,this.offset.y+i.y*this.scale.y);this.ctx.closePath(),this.ctx.lineWidth=s||1,this._fillOrDraw(t),this.ctx.restore()}}handle(e,t){this.point(e,"rgb(0,32,192)"),this.square(t,5,"rgba(0,128,192,0.5)")}handleLine(e,t){this.line(e,t,"rgb(192,192,192)")}dot(e,t){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(Math.round(this.offset.x+this.scale.x*e.x),Math.round(this.offset.y+this.scale.y*e.y)),this.ctx.lineTo(Math.round(this.offset.x+this.scale.x*e.x+1),Math.round(this.offset.y+this.scale.y*e.y+1)),this.ctx.closePath(),this.ctx.lineWidth=1,this._fillOrDraw(t),this.ctx.restore()}point(e,t){this.ctx.beginPath(),this.ctx.arc(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y,3,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.lineWidth=1,this._fillOrDraw(t)}circle(e,t,s,i){this.ctx.beginPath(),this.ctx.ellipse(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y,t*this.scale.x,t*this.scale.y,0,0,2*Math.PI),this.ctx.closePath(),this.ctx.lineWidth=i||1,this._fillOrDraw(s)}circleArc(e,t,s,i,r,n,a){a&&a.asSegment||this.ctx.beginPath(),this.ctx.ellipse(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y,t*this.scale.x,t*this.scale.y,0,s,i,!1),a&&a.asSegment||(this.ctx.lineWidth=n||1,this._fillOrDraw(r||"#000000"))}ellipse(e,t,s,i,r,n){void 0===n&&(n=0),this.ctx.beginPath(),this.ctx.ellipse(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y,t*this.scale.x,s*this.scale.y,n,0,2*Math.PI),this.ctx.closePath(),this.ctx.lineWidth=r||1,this._fillOrDraw(i)}square(e,t,s,i){this.ctx.beginPath(),this.ctx.rect(this.offset.x+(e.x-t/2)*this.scale.x,this.offset.y+(e.y-t/2)*this.scale.y,t*this.scale.x,t*this.scale.y),this.ctx.closePath(),this.ctx.lineWidth=i||1,this._fillOrDraw(s)}grid(e,t,s,i,r,n){this.ctx.beginPath();for(var a=-Math.ceil(.5*s/r)*r,o=s/2,h=-Math.ceil(.5*t/i)*i;h<t/2;h+=i)this.ctx.moveTo(this.offset.x+(e.x+h)*this.scale.x,this.offset.y+(e.y+a)*this.scale.y),this.ctx.lineTo(this.offset.x+(e.x+h)*this.scale.x,this.offset.y+(e.y+o)*this.scale.y);for(var l=-Math.ceil(.5*t/i)*i,c=t/2,u=-Math.ceil(.5*s/r)*r;u<s/2;u+=r)this.ctx.moveTo(this.offset.x+(e.x+l)*this.scale.x-4,this.offset.y+(e.y+u)*this.scale.y),this.ctx.lineTo(this.offset.x+(e.x+c)*this.scale.x+4,this.offset.y+(e.y+u)*this.scale.y);this.ctx.strokeStyle=n,this.ctx.lineWidth=1,this.ctx.stroke(),this.ctx.closePath()}raster(e,t,s,i,r,n){this.ctx.save(),this.ctx.beginPath();for(var a=-Math.ceil(.5*t/i)*i;a<t/2;a+=i)for(var o=-Math.ceil(.5*s/r)*r;o<s/2;o+=r)this.ctx.moveTo(this.offset.x+(e.x+a)*this.scale.x-4,this.offset.y+(e.y+o)*this.scale.y),this.ctx.lineTo(this.offset.x+(e.x+a)*this.scale.x+4,this.offset.y+(e.y+o)*this.scale.y),this.ctx.moveTo(this.offset.x+(e.x+a)*this.scale.x,this.offset.y+(e.y+o)*this.scale.y-4),this.ctx.lineTo(this.offset.x+(e.x+a)*this.scale.x,this.offset.y+(e.y+o)*this.scale.y+4);this.ctx.strokeStyle=n,this.ctx.lineWidth=1,this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()}diamondHandle(e,t,s){this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+e.x*this.scale.x-t/2,this.offset.y+e.y*this.scale.y),this.ctx.lineTo(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y-t/2),this.ctx.lineTo(this.offset.x+e.x*this.scale.x+t/2,this.offset.y+e.y*this.scale.y),this.ctx.lineTo(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y+t/2),this.ctx.closePath(),this.ctx.lineWidth=1,this._fillOrDraw(s)}squareHandle(e,t,s){this.ctx.beginPath(),this.ctx.rect(this.offset.x+e.x*this.scale.x-t/2,this.offset.y+e.y*this.scale.y-t/2,t,t),this.ctx.closePath(),this.ctx.lineWidth=1,this._fillOrDraw(s)}circleHandle(e,t,s){t=t||3,this.ctx.beginPath(),this.ctx.arc(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y,t,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.lineWidth=1,this._fillOrDraw(s)}crosshair(e,t,s){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.offset.x+e.x*this.scale.x-t,this.offset.y+e.y*this.scale.y),this.ctx.lineTo(this.offset.x+e.x*this.scale.x+t,this.offset.y+e.y*this.scale.y),this.ctx.moveTo(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y-t),this.ctx.lineTo(this.offset.x+e.x*this.scale.x,this.offset.y+e.y*this.scale.y+t),this.ctx.strokeStyle=s,this.ctx.lineWidth=.5,this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore()}polygon(e,t,s){this.polyline(e.vertices,e.isOpen,t,s)}polyline(e,t,s,i){if(!(e.length<=1)){this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=i||1,this.ctx.moveTo(this.offset.x+e[0].x*this.scale.x,this.offset.y+e[0].y*this.scale.y);for(var r=0;r<e.length;r++)this.ctx.lineTo(this.offset.x+e[r].x*this.scale.x,this.offset.y+e[r].y*this.scale.y);t||this.ctx.closePath(),this._fillOrDraw(s),this.ctx.closePath(),this.ctx.setLineDash([]),this.ctx.restore()}}text(e,t,s,i){i=i||{},this.ctx.save(),t=this.offset.x+t*this.scale.x,s=this.offset.y+s*this.scale.y;const r=i.color||"black";this.fillShapes?(this.ctx.fillStyle=r,this.ctx.fillText(e,t,s)):(this.ctx.strokeStyle=r,this.ctx.strokeText(e,t,s)),this.ctx.restore()}label(e,t,s,i,r){this.ctx.save(),this.ctx.translate(t,s),void 0!==i&&this.ctx.rotate(i),this.ctx.fillStyle=r||"black",this.fillShapes?this.ctx.fillText(e,0,0):this.ctx.strokeText(e,0,0),this.ctx.restore()}path(e,t,s,i){const r=i&&i.inplace?e:p.copyPathData(e);p.transformPathData(r,this.offset,this.scale),this.ctx.strokeStyle=t,this.ctx.lineWidth=s||1,this.fillShapes?(this.ctx.fillStyle=t,this.ctx.fill(new Path2D(r.join(" ")))):(this.ctx.strokeStyle=t,this.ctx.stroke(new Path2D(r.join(" "))))}clear(e){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}}class y{constructor(e,t){this.gl=e,this.offset=new a(0,0),this.scale=new a(1,1),this.fillShapes=t,this._zindex=0,null!=e&&void 0!==e&&(this.glutils=new x(e),this._vertShader=this.glutils.compileShader(y.vertCode,this.gl.VERTEX_SHADER),this._fragShader=this.glutils.compileShader(y.fragCode,this.gl.FRAGMENT_SHADER),this._program=this.glutils.makeProgram(this._vertShader,this._fragShader),this.vertex_buffer=this.gl.createBuffer(),console.log("gl initialized"))}_x2rel(e){return(this.scale.x*e+this.offset.x)/this.gl.canvas.width*2-1}_y2rel(e){return(this.offset.y-this.scale.y*e)/this.gl.canvas.height*2-1}copyInstance(e){var t=new y(null,e);return t.gl=this.gl,t.glutils=this.glutils,t._vertShader=this._vertShader,t._fragShader=this._fragShader,t._program=this._program,t}beginDrawCycle(e){this._zindex=0,this.renderTime=e}endDrawCycle(e){}setConfiguration(e){}setCurrentId(e){this.curId=e}setCurrentClassName(e){}line(e,t,s){const i=new Float32Array(6);i[0]=this._x2rel(e.x),i[1]=this._y2rel(e.y),i[2]=this._zindex,i[3]=this._x2rel(t.x),i[4]=this._y2rel(t.y),i[5]=this._zindex,this._zindex+=.001,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertex_buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.STATIC_DRAW);var r=this.gl.getAttribLocation(this._program,"position");this.gl.vertexAttribPointer(r,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(r),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);let n=this.gl.getUniformLocation(this._program,"uRotationVector");this.gl.uniform2fv(n,[0,1]),this.gl.lineWidth(5),this.gl.drawArrays(this.gl.LINES,0,i.length/3)}arrow(e,t,s){}image(e,t,s){}_fillOrDraw(e){}cubicBezier(e,t,s,i,r,n){}cubicBezierPath(e,t,s){}handle(e,t){}handleLine(e,t){}dot(e,t){}point(e,t){}circle(e,t,s,i){}circleArc(e,t,s,i,r,n){}ellipse(e,t,s,i,r,n){}square(e,t,s,i){}rect(e,t,s,i,r){}grid(e,t,s,i,r,n){}raster(e,t,s,i,r,n){}diamondHandle(e,t,s){}squareHandle(e,t,s){}circleHandle(e,t,s){}crosshair(e,t,s){}polygon(e,t,s){const i=new Float32Array(3*e.vertices.length);for(var r=0;r<e.vertices.length;r++)i[3*r+0]=this._x2rel(e.vertices[r].x),i[3*r+1]=this._y2rel(e.vertices[r].y),i[3*r+2]=this._zindex;this._zindex+=.001,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertex_buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.STATIC_DRAW);var n=this.gl.getAttribLocation(this._program,"position");this.gl.vertexAttribPointer(n,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(n),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);let a=this.gl.getUniformLocation(this._program,"uRotationVector");this.gl.uniform2fv(a,[0,1]),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,i.length/3)}polyline(e,t,s,i){}text(e,t,s,i){}label(e,t,s,i){}path(e,t,s,i){}clear(e){this.gl.clearColor(1,1,1,1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}}y.vertCode="\n    precision mediump float;\n\n    attribute vec3 position;\n\n    uniform vec2 uRotationVector;\n\n    void main(void) {\n\tvec2 rotatedPosition = vec2(\n\t    position.x * uRotationVector.y +\n\t\tposition.y * uRotationVector.x,\n\t    position.y * uRotationVector.y -\n\t\tposition.x * uRotationVector.x\n\t);\n\n\tgl_Position = vec4(rotatedPosition, position.z, 1.0);\n    }",y.fragCode="\n    precision highp float;\n\n    void main(void) {\n\tgl_FragColor = vec4(0.0,0.75,1.0,1.0);\n    }";class x{constructor(e){this.gl=e}bufferData(e){var t=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),t}compileShader(e,t){var s=this.gl.createShader(t);this.gl.shaderSource(s,e),this.gl.compileShader(s);return this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS)?s:(console.warn("Error in shader:"+this.gl.getShaderInfoLog(s)),this.gl.deleteShader(s),null)}makeProgram(e,t){var s=this.gl.createProgram();return this.gl.attachShader(s,e),this.gl.attachShader(s,t),this.gl.linkProgram(s),this.gl.useProgram(s),this.gl.detachShader(s,e),this.gl.detachShader(s,t),this.gl.deleteShader(e),this.gl.deleteShader(t),s}}class b{constructor(e,t,s){this.className="Triangle",this.uid=i.next(),this.a=e,this.b=t,this.c=s,this.calcCircumcircle()}static fromArray(e){if(e.length<3)throw`Cannot create triangle from array with less than three vertices (${e.length})`;return new b(e[0],e[1],e[2])}getArea(){return Math.abs(b.utils.signedArea(this.a.x,this.a.y,this.b.x,this.b.y,this.c.x,this.c.y))}getCentroid(){return new a((this.a.x+this.b.x+this.c.x)/3,(this.a.y+this.b.y+this.c.y)/3)}scaleToCentroid(e){let t=this.getCentroid();return this.a.scale(e,t),this.b.scale(e,t),this.c.scale(e,t),this}getCircumcircle(){return this.calcCircumcircle(),new g(this.center.clone(),this.radius)}isAdjacent(e){var t=this.a.equals(e.a)||this.a.equals(e.b)||this.a.equals(e.c),s=this.b.equals(e.a)||this.b.equals(e.b)||this.b.equals(e.c),i=this.c.equals(e.a)||this.c.equals(e.b)||this.c.equals(e.c);return t&&s||t&&i||s&&i}getThirdVertex(e,t){return this.a.equals(e)&&this.b.equals(t)||this.a.equals(t)&&this.b.equals(e)?this.c:this.b.equals(e)&&this.c.equals(t)||this.b.equals(t)&&this.c.equals(e)?this.a:this.b}calcCircumcircle(){const e=this.b.x-this.a.x,t=this.b.y-this.a.y,s=this.c.x-this.a.x,i=this.c.y-this.a.y,r=e*(this.a.x+this.b.x)+t*(this.a.y+this.b.y),n=s*(this.a.x+this.c.x)+i*(this.a.y+this.c.y),o=2*(e*(this.c.y-this.b.y)-t*(this.c.x-this.b.x));let h,l;if(Math.abs(o)<b.EPSILON){const e=this.bounds();this.center=new a((e.min.x+e.max.x)/2,(e.min.y+e.max.y)/2),h=this.center.x-e.min.x,l=this.center.y-e.min.y}else{const c=(i*r-t*n)/o,u=(e*n-s*r)/o;this.center=new a(c,u),h=this.center.x-this.a.x,l=this.center.y-this.a.y}this.radius_squared=h*h+l*l,this.radius=Math.sqrt(this.radius_squared)}inCircumcircle(e){const t=this.center.x-e.x,s=this.center.y-e.y;return t*t+s*s<=this.radius_squared}bounds(){return new h(new a(b.utils.min3(this.a.x,this.b.x,this.c.x),b.utils.min3(this.a.y,this.b.y,this.c.y)),new a(b.utils.max3(this.a.x,this.b.x,this.c.x),b.utils.max3(this.a.y,this.b.y,this.c.y)))}toPolygon(){return new o([this.a,this.b,this.c])}determinant(){return(this.b.y-this.a.y)*(this.c.x-this.b.x)-(this.c.y-this.b.y)*(this.b.x-this.a.x)}containsPoint(e){return b.utils.pointIsInTriangle(e.x,e.y,this.a.x,this.a.y,this.b.x,this.b.y,this.c.x,this.c.y)}getIncircularTriangle(){const e=new f(this.a,this.b),t=new f(this.b,this.c),s=new f(this.c,this.a),i=w.nsectAngle(this.b,this.a,this.c,2)[0],r=w.nsectAngle(this.c,this.b,this.a,2)[0],n=i.intersection(r),a=e.getClosestPoint(n),o=t.getClosestPoint(n),h=s.getClosestPoint(n);return new b(a,o,h)}getIncircle(){return this.getIncircularTriangle().getCircumcircle()}getIncenter(){return this.center&&this.radius||this.calcCircumcircle(),this.center.clone()}toString(){return"{ a : "+this.a.toString()+", b : "+this.b.toString()+", c : "+this.c.toString()+"}"}toSVGString(e){e=e||{};var t=[];t.push("<path"),e.className&&t.push(' class="'+e.className+'"'),t.push(' d="');var s=[this.a,this.b,this.c];if(s.length>0){t.push("M "),t.push(s[0].x),t.push(" "),t.push(s[0].y);for(var i=1;i<s.length;i++)t.push(" L "),t.push(s[i].x),t.push(" "),t.push(s[i].y);t.push(" Z")}return t.push('" />'),t.join("")}}b.EPSILON=1e-6,b.utils={max3:(e,t,s)=>e>=t&&e>=s?e:t>=e&&t>=s?t:s,min3:(e,t,s)=>e<=t&&e<=s?e:t<=e&&t<=s?t:s,signedArea:(e,t,s,i,r,n)=>.5*(-i*r+t*(-s+r)+e*(i-n)+s*n),pointIsInTriangle(e,t,s,i,r,n,a,o){var h=b.utils.signedArea(s,i,r,n,a,o),l=1/(2*h)*(i*a-s*o+(o-i)*e+(s-a)*t),c=1/(2*h)*(s*n-i*r+(i-n)*e+(r-s)*t);return l>0&&c>0&&1-l-c>0}};const w={nsectAngle(e,t,s,i){const r=new b(e,t,s),n=new f(e,t),a=new f(e,s);var o=n.angle(a);const h=r.determinant()>0;o<0&&(o=2*Math.PI+o),h||(o=-1*(2*Math.PI-o));const l=Math.max(n.length(),a.length())/n.length();for(var c=[],u=1;u<i;u++)c.push(new f(e,t.clone().rotate(o/i*-u,e)).scale(l));return c},wrapMax:(e,t)=>(t+e%t)%t,wrapMinMax:(e,t,s)=>t+w.wrapMax(e-t,s-t)};class C{constructor(e,t){this.center=e,this.size=t}}C.utils={baseLog:(e,t)=>Math.log(e)/Math.log(t),mapRasterScale:(e,t)=>{var s=1;return t>=1?(s=Math.abs(Math.floor(1/C.utils.baseLog(e,t))),s=1/Math.pow(e,s)):s=Math.abs(Math.floor(C.utils.baseLog(1/e,1/(t+1)))),s}};class P{constructor(e){this.downListeners=[],this.pressListeners=[],this.upListeners=[],this.keyStates={},e=e||{},this.element=e.element?e.element:globalThis,this.downListeners=[],this.pressListeners=[],this.upListeners=[],this.keyStates=[],this.trackAllKeys=e.trackAll||!1,this.installListeners()}fireEvent(e,t){let s=!1;for(var i in t){var r=t[i];r.keyCode==e.keyCode&&(r.listener(e),s=!0)}return s}fireDownEvent(e,t){(t.fireEvent(e,t.downListeners)||t.trackAllKeys)&&(t.keyStates[e.keyCode]="down")}firePressEvent(e,t){t.fireEvent(e,t.pressListeners)}fireUpEvent(e,t){(t.fireEvent(e,t.upListeners)||t.trackAllKeys)&&delete t.keyStates[e.keyCode]}static key2code(e){if("number"==typeof e)return e;if("string"!=typeof e)throw"Unknown key name or key type (should be a string or integer): "+e;if(P.KEY_CODES[e])return P.KEY_CODES[e];throw"Unknown key (cannot resolve key code): "+e}installListeners(){var e=this;this.element.addEventListener("keydown",this._keyDownListener=t=>{e.fireDownEvent(t,e)}),this.element.addEventListener("keypress",this._keyPressListener=t=>{e.firePressEvent(t,e)}),this.element.addEventListener("keyup",this._keyUpListener=t=>{e.fireUpEvent(t,e)})}releaseListeners(){this.element.removeEventListener("keydown",this._keyDownListener),this.element.removeEventListener("keypress",this._keyPressListener),this.element.removeEventListener("keyup",this._keyUpListener)}down(e,t){return this.downListeners.push({key:e,keyCode:P.key2code(e),listener:t}),this}press(e,t){return this.pressListeners.push({key:e,keyCode:P.key2code(e),listener:t}),this}up(e,t){return this.upListeners.push({key:e,keyCode:P.key2code(e),listener:t}),this}isDown(e){return"number"==typeof e?!!this.keyStates[e]:!!this.keyStates[P.key2code(e)]}}P.KEY_CODES={break:3,backspace:8,tab:9,clear:12,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,hangul:21,hanja:25,escape:27,conversion:28,"non-conversion":29,spacebar:32,pageup:33,pagedown:34,end:35,home:36,leftarrow:37,uparrow:38,rightarrow:39,downarrow:40,select:41,print:42,execute:43,printscreen:44,insert:45,delete:46,help:47,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,":":58,"semicolon (firefox)":59,equals:59,"<":60,"equals (firefox)":61,:63,"@ (firefox)":64,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,windows:91,leftcommand:91,chromebooksearch:91,rightwindowkey:92,windowsmenu:93,rightcommant:93,sleep:95,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,numpadperiod:108,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,f13:124,f14:125,f15:126,f16:127,f17:128,f18:129,f19:130,f20:131,f21:132,f22:133,f23:134,f24:135,numlock:144,scrolllock:145,"^":160,"!":161,"#":163,$:164,:165,pagebackward:166,pageforward:167,refresh:168,closingparen:169,"*":170,"~+*":171,minus:173,decreasevolumelevel:174,increasevolumelevel:175,next:176,previous:177,stop:178,"play/pause":179,email:180,mute:181,unmute:181,semicolon:186,:186,equal:187,comma:188,dash:189,period:190,forwardslash:191,:191,"grave accent":192,:192,:192,"?":193,"/":193,"":193,openbracket:219,backslash:220,closebracket:221,:221,singlequote:222,:222,:222,"`":223,altgr:225,"GNOME Compose Key":230,XF86Forward:233,XF86Back:234,alphanumeric:240,hiragana:242,katakana:242,"half-width":243,"full-width":243,kanji:244,unlocktrackpad:251,toggletouchpad:255};class S extends MouseEvent{}class _ extends WheelEvent{}class A{constructor(e,t){this.mouseDownPos=void 0,this.mouseDragPos=void 0,this.mouseButton=-1,this.listeners={},this.installed={},this.handlers={},this.name=t,this.element=e,this.mouseDownPos=null,this.mouseDragPos=null,this.mouseButton=-1,this.listeners={},this.installed={},this.handlers={};const s=this;this.handlers.mousemove=e=>{s.listeners.mousemove&&s.listeners.mousemove(s.mkParams(e,"mousemove")),s.mouseDragPos&&s.listeners.drag&&s.listeners.drag(s.mkParams(e,"drag")),s.mouseDownPos&&(s.mouseDragPos=s.relPos(e))},this.handlers.mouseup=e=>{s.listeners.mouseup&&s.listeners.mouseup(s.mkParams(e,"mouseup")),s.mouseDragPos=void 0,s.mouseDownPos=void 0,s.mouseButton=-1},this.handlers.mousedown=e=>{s.mouseDragPos=s.relPos(e),s.mouseDownPos=s.relPos(e),s.mouseButton=e.button,s.listeners.mousedown&&s.listeners.mousedown(s.mkParams(e,"mousedown"))},this.handlers.click=e=>{s.listeners.click&&s.listeners.click(s.mkParams(e,"click"))},this.handlers.wheel=e=>{s.listeners.wheel&&s.listeners.wheel(s.mkParams(e,"wheel"))},this.element.addEventListener("mousemove",this.handlers.mousemove),this.element.addEventListener("mouseup",this.handlers.mouseup),this.element.addEventListener("mousedown",this.handlers.mousedown),this.element.addEventListener("click",this.handlers.click),this.element.addEventListener("wheel",this.handlers.wheel)}relPos(e){return{x:e.offsetX,y:e.offsetY}}mkParams(e,t){const s=this.relPos(e),i=e;return i.params={element:this.element,name:t,isTouchEvent:!1,pos:s,button:this.mouseButton,leftButton:0==this.mouseButton,middleButton:1==this.mouseButton,rightButton:2==this.mouseButton,mouseDownPos:this.mouseDownPos,draggedFrom:this.mouseDragPos,wasDragged:null!=this.mouseDownPos&&(this.mouseDownPos.x!=s.x||this.mouseDownPos.y!=s.y),dragAmount:null!=this.mouseDownPos?{x:s.x-this.mouseDragPos.x,y:s.y-this.mouseDragPos.y}:{x:0,y:0}},i}listenFor(e){this.installed[e]||(this.installed[e]=!0)}unlistenFor(e){this.installed[e]&&delete this.installed[e]}drag(e){return this.listeners.drag&&this.throwAlreadyInstalled("drag"),this.listeners.drag=e,this.listenFor("mousedown"),this.listenFor("mousemove"),this.listenFor("mouseup"),this}move(e){return this.listeners.mousemove&&this.throwAlreadyInstalled("mousemove"),this.listenFor("mousemove"),this.listeners.mousemove=e,this}up(e){return this.listeners.mouseup&&this.throwAlreadyInstalled("mouseup"),this.listenFor("mouseup"),this.listeners.mouseup=e,this}down(e){return this.listeners.mousedown&&this.throwAlreadyInstalled("mousedown"),this.listenFor("mousedown"),this.listeners.mousedown=e,this}click(e){return this.listeners.click&&this.throwAlreadyInstalled("click"),this.listenFor("click"),this.listeners.click=e,this}wheel(e){return this.listeners.wheel&&this.throwAlreadyInstalled("wheel"),this.listenFor("wheel"),this.listeners.wheel=e,this}throwAlreadyInstalled(e){throw`This MouseHandler already has a '${e}' callback. To keep the code simple there is only room for one.`}destroy(){this.unlistenFor("mousedown"),this.unlistenFor("mousemove"),this.unlistenFor("moseup"),this.unlistenFor("click"),this.unlistenFor("wheel"),this.element.removeEventListener("mousemove",this.handlers.mousemove),this.element.removeEventListener("mouseup",this.handlers.mousedown),this.element.removeEventListener("mousedown",this.handlers.mousedown),this.element.removeEventListener("click",this.handlers.click),this.element.removeEventListener("wheel",this.handlers.wheel)}}class T{constructor(e,t,s){this.className="PBImage",this.uid=i.next(),this.image=e,this.upperLeft=t,this.lowerRight=s}toSVGString(e){return console.warn("PBImage is not yet SVG serializable. Returning empty SVG string."),""}}var I,M=s(321);class E{constructor(e,t,s){this.className="VEllipse",this.uid=i.next(),this.center=e,this.axis=t,this.rotation=s||0}clone(){return new E(this.center.clone(),this.axis.clone(),this.rotation)}radiusH(){return Math.abs(this.signedRadiusH())}signedRadiusH(){return new a(this.axis).rotate(-this.rotation,this.center).x-this.center.x}radiusV(){return Math.abs(this.signedRadiusV())}signedRadiusV(){return new a(this.axis).rotate(-this.rotation,this.center).y-this.center.y}scale(e){return this.axis.scale(e,this.center),this}rotate(e){return this.axis.rotate(e,this.center),this.rotation+=e,this}vertAt(e){const t=this.radiusH(),s=this.radiusV();return new a(E.utils.polarToCartesian(this.center.x,this.center.y,t,s,e)).rotate(this.rotation,this.center)}normalAt(e,t){const s=this.vertAt(e),i=this.getFoci(),r=new f(s,i[0]).angle(),n=r+(new f(s,i[1]).angle()-r)/2,a=s.clone().addX(50).clone().rotate(n,s),o=s.clone().addX(50).clone().rotate(Math.PI+n,s);return this.center.distance(a)<this.center.distance(o)?new c(s,o):new c(s,a)}tangentAt(e,t){const s=this.normalAt(e,t);return s.b.rotate(Math.PI/2,s.a),s}perimeter(){const e=this.radiusH(),t=this.radiusV();return Math.PI*(3*(e+t)-Math.sqrt((3*e+t)*(e+3*t)))}getFoci(){const e=this.radiusH(),t=this.radiusV(),s=e*e-t*t,i=Math.sqrt(Math.abs(s));return s<0?[this.center.clone().addY(i).rotate(this.rotation,this.center),this.center.clone().addY(-i).rotate(this.rotation,this.center)]:[this.center.clone().addX(i).rotate(this.rotation,this.center),this.center.clone().addX(-i).rotate(this.rotation,this.center)]}getEquidistantVertices(e){const t=E.utils.equidistantVertAngles(this.radiusH(),this.radiusV(),e),s=[];for(var i=0;i<t.length;i++)s.push(this.vertAt(t[i]));return s}toCubicBezier(e,t){const s=4*Math.max(1,e||3);t=void 0===t?.666666:t;const i=this.radiusH(),r=this.radiusV(),n=[],a=E.utils.equidistantVertAngles(i,r,s);let o=a[0],h=this.vertAt(o);for(var l=0;l<a.length;l++){let e=a[(l+1)%a.length],s=this.vertAt(e);if(Math.abs(r)<1e-4||Math.abs(i)<1e-4){let e=h.difference(s),t=new u(h.clone(),s.clone(),h.clone().addXY(.333*e.x,.333*e.y),s.clone().addXY(.333*-e.x,.333*-e.y));n.push(t)}else{let i=this.tangentAt(o),r=this.tangentAt(e),a=i.intersection(r),l=h.difference(a),c=s.difference(a),d=new u(h.clone(),s.clone(),h.clone().add(l.scale(t)),s.clone().add(c.scale(t)));n.push(d)}h=s,o=e}return n}toSVGString(e){e=e||{};var t=[];return t.push("<ellipse"),e.className&&t.push(' class="'+e.className+'"'),t.push(' cx="'+this.center.x+'"'),t.push(' cy="'+this.center.y+'"'),t.push(' rx="'+this.axis.x+'"'),t.push(' ry="'+this.axis.y+'"'),t.push(" />"),t.join("")}}E.utils={polarToCartesian:(e,t,s,i,r)=>{var n=Math.sin(Math.PI/2-r),a=Math.cos(Math.PI/2-r);return{x:e+s*i*n/Math.sqrt(Math.pow(s*a,2)+Math.pow(i*n,2)),y:t+s*i*a/Math.sqrt(Math.pow(s*a,2)+Math.pow(i*n,2))}},phiToTheta:(e,t,s)=>{var i=Math.tan(s),r=i*i;return-Math.PI/2+s+Math.atan((e-t)*i/(t+e*r))},equidistantVertAngles:(e,t,s)=>{const i=[];for(var r=0;r<s;r++){var n=Math.PI/2+2*Math.PI/s*r;let a=E.utils.phiToTheta(e,t,n);i[r]=a}return i}};class N{constructor(e,t,s){this.className="VEllipseSector",this.uid=i.next(),this.ellipse=e,this.startAngle=w.wrapMinMax(t,0,2*Math.PI),this.endAngle=w.wrapMinMax(s,0,2*Math.PI)}toCubicBezier(e,t){const s=4*Math.max(1,e||3);t=void 0===t?.666666:t;const i=this.ellipse.radiusH(),r=this.ellipse.radiusV();var n=N.ellipseSectorUtils.normalizeAngle(this.startAngle),a=N.ellipseSectorUtils.normalizeAngle(this.endAngle),o=N.ellipseSectorUtils.equidistantVertAngles(i,r,n,a,s);const h=[];let l=(o=[n].concat(o).concat([a]))[0],c=this.ellipse.vertAt(l);for(var d=0;d+1<o.length;d++){let e=o[(d+1)%o.length],s=this.ellipse.vertAt(e),n=this.ellipse.tangentAt(l),a=this.ellipse.tangentAt(e);if(Math.abs(r)<1e-4||Math.abs(i)<1e-4){let e=c.difference(s),t=new u(c.clone(),s.clone(),c.clone().addXY(.333*e.x,.333*e.y),s.clone().addXY(.333*-e.x,.333*-e.y));h.push(t)}else{let e=n.intersection(a),i=c.difference(e),r=s.difference(e),o=new u(c.clone(),s.clone(),c.clone().add(i.scale(t)),s.clone().add(r.scale(t)));h.push(o)}c=s,l=e}return h}}N.ellipseSectorUtils={describeSVGArc:(e,t,s,i,r,n,o,h)=>{void 0===h&&(h={moveToStart:!0}),void 0===o&&(o=0),r=w.wrapMax(r,2*Math.PI),n=w.wrapMax(n,2*Math.PI);var l=new a(E.utils.polarToCartesian(e,t,s,i,n)),c=new a(E.utils.polarToCartesian(e,t,s,i,r));l.rotate(o,{x:e,y:t}),c.rotate(o,{x:e,y:t});var u,d=n-r;u=d<0?Math.abs(d)<Math.PI?1:0:Math.abs(d)>Math.PI?1:0;const f=[];h.moveToStart&&f.push("M",c.x,c.y);const g=180/Math.PI;return f.push("A",s,i,o*g,u,1,l.x,l.y),f},equidistantVertAngles:(e,t,s,i,r)=>{for(var n=(n=(n=E.utils.equidistantVertAngles(e,t,r)).map((e=>N.ellipseSectorUtils.normalizeAngle(e)))).filter((e=>s<i?e>=s&&e<=i:e>=s||e<=i&&e>=0)),a=N.ellipseSectorUtils.findClosestToStartAngle(s,i,n),o=[],h=0;h<n.length;h++)o.push(n[(a+h)%n.length]);return o},findClosestToStartAngle:(e,t,s)=>{if(e>t){const r=s.length;for(var i=0;i<r;i++){const r=w.wrapMinMax(s[i],0,2*Math.PI);if(r>=e&&r>=t)return i}}return 0},normalizeAngle:e=>e<0?2*Math.PI+e:e,endpointToCenterParameters(e,t,s,i,r,n,o,h,l){const c=Math.abs,u=Math.sin,d=Math.cos,g=Math.sqrt,v=e=>e*e,p=u(r),m=d(r),y=m*(e-h)/2+p*(t-l)/2,x=-p*(e-h)/2+m*(t-l)/2,b=v(y),w=v(x),C=v(s),P=v(i),S=b/C+w/P;S>1?(s=g(S)*c(s),i=g(S)*c(i)):(s=c(s),i=c(i));const _=n===o?-1:1,A=g((C*P-C*w-P*b)/(C*w+P*b))*_,T=A*(s*x)/i,I=A*(-i*y)/s,M=new a(m*T-p*I+(e+h)/2,p*T+m*I+(t+l)/2),L=M.clone().addXY(s,i),z=new E(M,L,0);z.rotate(r);const V=new f(z.center,new a(e,t)).angle(),k=new f(z.center,new a(h,l)).angle();return new N(z,V-r,k-r)}};class L{constructor(e){if(this.renderTime=0,r.model={bezierAutoAdjust:!1,renderTime:0,selectable:!0,isSelected:!1,draggable:!0,visible:!0},void 0===e.canvas)throw"No canvas specified.";const t=L.utils.fetch;this.config={canvas:e.canvas,fullSize:t.val(e,"fullSize",!0),fitToParent:t.bool(e,"fitToParent",!0),scaleX:t.num(e,"scaleX",1),scaleY:t.num(e,"scaleY",1),offsetX:t.num(e,"offsetX",0),offsetY:t.num(e,"offsetY",0),rasterGrid:t.bool(e,"rasterGrid",!0),rasterScaleX:t.num(e,"rasterScaleX",1),rasterScaleY:t.num(e,"rasterScaleY",1),rasterAdjustFactor:t.num(e,"rasterAdjustdFactror",2),drawOrigin:t.bool(e,"drawOrigin",!1),autoAdjustOffset:t.val(e,"autoAdjustOffset",!0),offsetAdjustXPercent:t.num(e,"offsetAdjustXPercent",50),offsetAdjustYPercent:t.num(e,"offsetAdjustYPercent",50),backgroundColor:e.backgroundColor||"#ffffff",redrawOnResize:t.bool(e,"redrawOnResize",!0),defaultCanvasWidth:t.num(e,"defaultCanvasWidth",L.DEFAULT_CANVAS_WIDTH),defaultCanvasHeight:t.num(e,"defaultCanvasHeight",L.DEFAULT_CANVAS_HEIGHT),canvasWidthFactor:t.num(e,"canvasWidthFactor",1),canvasHeightFactor:t.num(e,"canvasHeightFactor",1),cssScaleX:t.num(e,"cssScaleX",1),cssScaleY:t.num(e,"cssScaleY",1),cssUniformScale:t.bool(e,"cssUniformScale",!0),saveFile:()=>{i.hooks.saveFile(i)},setToRetina:()=>{i._setToRetina()},autoDetectRetina:t.bool(e,"autoDetectRetina",!0),enableSVGExport:t.bool(e,"enableSVGExport",!0),preClear:t.func(e,"preClear",null),preDraw:t.func(e,"preDraw",null),postDraw:t.func(e,"postDraw",null),enableMouse:t.bool(e,"enableMouse",!0),enableTouch:t.bool(e,"enableTouch",!0),enableKeys:t.bool(e,"enableKeys",!0),enableMouseWheel:t.bool(e,"enableMouseWheel",!0),enableGL:t.bool(e,"enableGL",!1)},this.drawConfig={drawVertices:!0,drawBezierHandleLines:t.bool(e,"drawBezierHandleLines",!0),drawBezierHandlePoints:t.bool(e,"drawBezierHandlePoints",!0),drawHandleLines:t.bool(e,"drawHandleLines",!0),drawHandlePoints:t.bool(e,"drawHandlePoints",!0),drawGrid:t.bool(e,"drawGrid",!0),bezier:{color:"#00a822",lineWidth:2,handleLine:{color:"rgba(180,180,180,0.5)",lineWidth:1},pathVertex:{color:"#B400FF",lineWidth:1,fill:!0},controlVertex:{color:"#B8D438",lineWidth:1,fill:!0}},polygon:{color:"#0022a8",lineWidth:1},triangle:{color:"#6600ff",lineWidth:1},ellipse:{color:"#2222a8",lineWidth:1},ellipseSector:{color:"#a822a8",lineWidth:2},circle:{color:"#22a8a8",lineWidth:2},circleSector:{color:"#2280a8",lineWidth:1},vertex:{color:"#a8a8a8",lineWidth:1},selectedVertex:{color:"#c08000",lineWidth:2},line:{color:"#a844a8",lineWidth:1},vector:{color:"#ff44a8",lineWidth:1},image:{color:"#a8a8a8",lineWidth:1}},this.grid=new C(new a(0,0),new a(50,50)),this.canvasSize={width:L.DEFAULT_CANVAS_WIDTH,height:L.DEFAULT_CANVAS_HEIGHT};const s="string"==typeof e.canvas?document.querySelector(e.canvas):e.canvas;if("canvas"===s.tagName.toLowerCase())if(this.canvas=s,this.eventCatcher=this.canvas,this.config.enableGL&&void 0===y&&(console.warn("Cannot use webgl. Package was compiled without experimental gl support. Please use plotboilerplate-glsupport.min.js instead."),console.warn("Disabling GL and falling back to Canvas2D."),this.config.enableGL=!1),this.config.enableGL){const e=this.canvas.getContext("webgl");this.draw=new y(e,!1),this.fill=this.draw.copyInstance(!0),console.warn("Initialized with experimental mode enableGL=true. Note that this is not yet fully implemented.")}else{const e=this.canvas.getContext("2d");this.draw=new m(e,!1),this.fill=new m(e,!0)}else{if("svg"!==s.tagName.toLowerCase())throw"Element is neither a canvas nor an svg element.";if(void 0===p)throw"The svg draw library is not yet integrated part of PlotBoilerplate. Please include ./src/js/utils/helpers/drawutils.svg into your document.";this.canvas=s,this.draw=new p(this.canvas,new a,new a,this.canvasSize,!1,this.drawConfig,!1),this.fill=this.draw.copyInstance(!0),this.canvas.parentElement?(this.eventCatcher=document.createElement("div"),this.eventCatcher.style.position="absolute",this.eventCatcher.style.left="0",this.eventCatcher.style.top="0",this.eventCatcher.style.cursor="pointer",this.canvas.parentElement.style.position="relative",this.canvas.parentElement.appendChild(this.eventCatcher)):this.eventCatcher=document.body}this.draw.scale.set(this.config.scaleX,this.config.scaleY),this.fill.scale.set(this.config.scaleX,this.config.scaleY),this.vertices=[],this.selectPolygon=null,this.draggedElements=[],this.drawables=[],this.console=console,this.hooks={saveFile:L._saveFile};var i=this;globalThis.addEventListener("resize",(()=>i.resizeCanvas())),this.resizeCanvas(),e.autoDetectRetina&&this._setToRetina(),this.installInputListeners(),this.updateCSSscale(),this.redraw(),this.canvas.focus()}static _saveFile(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");var s=new p(t,e.draw.offset,e.draw.scale,e.canvasSize,!1,e.drawConfig),i=s.copyInstance(!0);s.beginDrawCycle(0),i.beginDrawCycle(0),e.config.preClear&&e.config.preClear(),s.clear(e.config.backgroundColor),e.config.preDraw&&e.config.preDraw(s,i),e.drawAll(0,s,i),e.drawVertices(0,s),e.config.postDraw&&e.config.postDraw(s,i),s.endDrawCycle(0),i.endDrawCycle(0);var r=(new XMLSerializer).serializeToString(t),n=new Blob([r],{type:"image/svg;charset=utf-8"});if("function"!=typeof globalThis.saveAs)throw"Cannot save file; did you load the ./utils/savefile helper function and the eligrey/SaveFile library?";(0,globalThis.saveAs)(n,"plotboilerplate.svg")}_setToRetina(){this.config.autoDetectRetina=!0;const e=globalThis.devicePixelRatio||1;this.config.cssScaleX=this.config.cssScaleY=1/e,this.config.canvasWidthFactor=this.config.canvasHeightFactor=e,this.resizeCanvas(),this.updateCSSscale()}fitToView(e){const t=new a(this.canvasSize.width/2,this.canvasSize.height/2),s=this.canvasSize.width/this.canvasSize.height,i=e.width/e.height,r=new a(e.max.x-e.width/2,e.max.y-e.height/2).inv().addXY(this.canvasSize.width/2,this.canvasSize.height/2);if(this.setOffset(r),s<i){const s=this.canvasSize.width/e.width;this.setZoom(s,s,t)}else{const s=this.canvasSize.height/e.height;this.setZoom(s,s,t)}this.redraw()}setConsole(e){this.console=e}updateCSSscale(){this.config.cssUniformScale?L.utils.setCSSscale(this.canvas,this.config.cssScaleX,this.config.cssScaleX):L.utils.setCSSscale(this.canvas,this.config.cssScaleX,this.config.cssScaleY)}add(e,t){if(Array.isArray(e)){const t=e;for(var s=0;s<t.length;s++)this.add(t[s],!1)}else if(e instanceof a)this.drawables.push(e),this.vertices.push(e);else if(e instanceof f)this.drawables.push(e),this.vertices.push(e.a),this.vertices.push(e.b);else if(e instanceof c)this.drawables.push(e),this.vertices.push(e.a),this.vertices.push(e.b);else if(e instanceof E)this.vertices.push(e.center),this.vertices.push(e.axis),this.drawables.push(e),e.center.listeners.addDragListener((t=>{e.axis.add(t.params.dragAmount)}));else if(e instanceof N)this.vertices.push(e.ellipse.center),this.vertices.push(e.ellipse.axis),this.drawables.push(e),e.ellipse.center.listeners.addDragListener((t=>{e.ellipse.axis.add(t.params.dragAmount)}));else if(e instanceof g)this.vertices.push(e.center),this.drawables.push(e);else if(e instanceof v)this.vertices.push(e.circle.center),this.drawables.push(e);else if(e instanceof o){this.drawables.push(e);for(s=0;s<e.vertices.length;s++)this.vertices.push(e.vertices[s])}else if(e instanceof b)this.drawables.push(e),this.vertices.push(e.a),this.vertices.push(e.b),this.vertices.push(e.c);else if(e instanceof d){this.drawables.push(e);const t=e;for(s=0;s<t.bezierCurves.length;s++)e.adjustCircular||0!=s||this.vertices.push(t.bezierCurves[s].startPoint),this.vertices.push(t.bezierCurves[s].endPoint),this.vertices.push(t.bezierCurves[s].startControlPoint),this.vertices.push(t.bezierCurves[s].endControlPoint),t.bezierCurves[s].startControlPoint.attr.selectable=!1,t.bezierCurves[s].endControlPoint.attr.selectable=!1;L.utils.enableBezierPathAutoAdjust(e)}else{if(!(e instanceof T))throw"Cannot add drawable of unrecognized type: "+typeof e+".";this.vertices.push(e.upperLeft),this.vertices.push(e.lowerRight),this.drawables.push(e),e.upperLeft.listeners.addDragListener((t=>{e.lowerRight.add(t.params.dragAmount)})),e.lowerRight.attr.selectable=!1}(t||void 0===t)&&this.redraw()}remove(e,t,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)this.remove(e[i],!1,s);t&&this.redraw()}else{e instanceof a&&(this.removeVertex(e,!1),t&&this.redraw());for(i=0;i<this.drawables.length;i++)if(this.drawables[i]===e){if(this.drawables.splice(i,1),s)if(e instanceof f)this.removeVertex(e.a,!1),this.removeVertex(e.b,!1);else if(e instanceof c)this.removeVertex(e.a,!1),this.removeVertex(e.b,!1);else if(e instanceof E)this.removeVertex(e.center,!1),this.removeVertex(e.axis,!1);else if(e instanceof N)this.removeVertex(e.ellipse.center),this.removeVertex(e.ellipse.axis);else if(e instanceof g)this.removeVertex(e.center,!1);else if(e instanceof v)this.removeVertex(e.circle.center,!1);else if(e instanceof o)for(i=0;i<e.vertices.length;i++)this.removeVertex(e.vertices[i],!1);else if(e instanceof b)this.removeVertex(e.a,!1),this.removeVertex(e.b,!1),this.removeVertex(e.c,!1);else if(e instanceof d)for(i=0;i<e.bezierCurves.length;i++)this.removeVertex(e.bezierCurves[i].startPoint,!1),this.removeVertex(e.bezierCurves[i].startControlPoint,!1),this.removeVertex(e.bezierCurves[i].endControlPoint,!1),i+1==e.bezierCurves.length&&this.removeVertex(e.bezierCurves[i].endPoint,!1);else e instanceof T&&(this.removeVertex(e.upperLeft,!1),this.removeVertex(e.lowerRight,!1));t&&this.redraw()}}}removeVertex(e,t){for(var s=0;s<this.vertices.length;s++)if(this.vertices[s]===e)return this.vertices.splice(s,1),void(t&&this.redraw())}removeAll(e){this.drawables=[],Boolean(e)||(this.vertices=[]),this.redraw()}getVertexNear(e,t){var s=this.locatePointNear(this.transformMousePosition(e.x,e.y),t/Math.min(this.config.cssScaleX,this.config.cssScaleY));if(s&&"vertex"==s.typeName)return this.vertices[s.vindex]}drawGrid(e){void 0===e&&(e=this.draw);const t=C.utils.mapRasterScale(this.config.rasterAdjustFactor,this.draw.scale.x)*this.config.rasterScaleX/this.config.cssScaleX,s=C.utils.mapRasterScale(this.config.rasterAdjustFactor,this.draw.scale.y)*this.config.rasterScaleY/this.config.cssScaleY;var i={width:this.grid.size.x*t,height:this.grid.size.y*s},r=this.canvasSize.width/2,n=this.canvasSize.height/2,a=this.draw.offset.clone().inv();a.x=Math.round(a.x+r)/Math.round(i.width)*i.width/this.draw.scale.x+(this.draw.offset.x-r)/this.draw.scale.x%i.width,a.y=Math.round(a.y+n)/Math.round(i.height)*i.height/this.draw.scale.y+(this.draw.offset.y-n)/this.draw.scale.x%i.height,this.drawConfig.drawGrid&&(e.setCurrentClassName(null),this.config.rasterGrid?(e.setCurrentId("raster"),e.raster(a,this.canvasSize.width/this.draw.scale.x,this.canvasSize.height/this.draw.scale.y,i.width,i.height,"rgba(0,128,255,0.125)")):(e.setCurrentId("grid"),e.grid(a,this.canvasSize.width/this.draw.scale.x,this.canvasSize.height/this.draw.scale.y,i.width,i.height,"rgba(0,128,255,0.095)")))}drawOrigin(e){e.setCurrentId("origin"),e.crosshair({x:0,y:0},10,"#000000")}_handleColor(e,t){return e.attr.isSelected?this.drawConfig.selectedVertex.color:e.attr.draggable?t:"rgba(128,128,128,0.5)"}drawDrawables(e,t,s){for(var i in this.drawables){var r=this.drawables[i];this.draw.setCurrentId(r.uid),this.fill.setCurrentId(r.uid),this.draw.setCurrentClassName(r.className),this.draw.setCurrentClassName(r.className),this.drawDrawable(r,e,t,s)}}drawDrawable(e,t,s,i){if(e instanceof d)for(var r in e.bezierCurves){if(s.cubicBezier(e.bezierCurves[r].startPoint,e.bezierCurves[r].endPoint,e.bezierCurves[r].startControlPoint,e.bezierCurves[r].endControlPoint,this.drawConfig.bezier.color,this.drawConfig.bezier.lineWidth),this.drawConfig.drawBezierHandlePoints&&this.drawConfig.drawHandlePoints){if(e.bezierCurves[r].startPoint.attr.visible){const t=this.drawConfig.bezier.pathVertex.fill?i:s;t.setCurrentId(`${e.uid}_h0`),t.setCurrentClassName(`${e.className}-start-handle`),e.bezierCurves[r].startPoint.attr.bezierAutoAdjust?t.squareHandle(e.bezierCurves[r].startPoint,5,this._handleColor(e.bezierCurves[r].startPoint,this.drawConfig.bezier.pathVertex.color)):t.diamondHandle(e.bezierCurves[r].startPoint,7,this._handleColor(e.bezierCurves[r].startPoint,this.drawConfig.bezier.pathVertex.color))}if(e.bezierCurves[r].startPoint.attr.renderTime=t,e.bezierCurves[r].endPoint.attr.visible){const t=this.drawConfig.bezier.pathVertex.fill?i:s;t.setCurrentId(`${e.uid}_h0`),t.setCurrentClassName(`${e.className}-start-handle`),e.bezierCurves[r].endPoint.attr.bezierAutoAdjust?t.squareHandle(e.bezierCurves[r].endPoint,5,this._handleColor(e.bezierCurves[r].endPoint,this.drawConfig.bezier.pathVertex.color)):t.diamondHandle(e.bezierCurves[r].endPoint,7,this._handleColor(e.bezierCurves[r].endPoint,this.drawConfig.bezier.pathVertex.color))}if(e.bezierCurves[r].startControlPoint.attr.visible){const t=this.drawConfig.bezier.controlVertex.fill?i:s;t.setCurrentId(`${e.uid}_h2`),t.setCurrentClassName(`${e.className}-start-control-handle`),t.circleHandle(e.bezierCurves[r].startControlPoint,3,this._handleColor(e.bezierCurves[r].startControlPoint,this.drawConfig.bezier.controlVertex.color))}if(e.bezierCurves[r].endControlPoint.attr.visible){const t=this.drawConfig.bezier.controlVertex.fill?i:s;t.setCurrentId(`${e.uid}_h3`),t.setCurrentClassName(`${e.className}-end-control-handle`),t.circleHandle(e.bezierCurves[r].endControlPoint,3,this._handleColor(e.bezierCurves[r].endControlPoint,this.drawConfig.bezier.controlVertex.color))}e.bezierCurves[r].startPoint.attr.renderTime=t,e.bezierCurves[r].endPoint.attr.renderTime=t,e.bezierCurves[r].startControlPoint.attr.renderTime=t,e.bezierCurves[r].endControlPoint.attr.renderTime=t}else e.bezierCurves[r].startPoint.attr.renderTime=t,e.bezierCurves[r].endPoint.attr.renderTime=t,e.bezierCurves[r].startControlPoint.attr.renderTime=t,e.bezierCurves[r].endControlPoint.attr.renderTime=t;this.drawConfig.drawBezierHandleLines&&this.drawConfig.drawHandleLines&&(s.setCurrentId(`${e.uid}_l0`),s.setCurrentClassName(`${e.className}-start-line`),s.line(e.bezierCurves[r].startPoint,e.bezierCurves[r].startControlPoint,this.drawConfig.bezier.handleLine.color,this.drawConfig.bezier.handleLine.lineWidth),s.setCurrentId(`${e.uid}_l1`),s.setCurrentClassName(`${e.className}-end-line`),s.line(e.bezierCurves[r].endPoint,e.bezierCurves[r].endControlPoint,this.drawConfig.bezier.handleLine.color,this.drawConfig.bezier.handleLine.lineWidth))}else if(e instanceof o){if(s.polygon(e,this.drawConfig.polygon.color,this.drawConfig.polygon.lineWidth),!this.drawConfig.drawHandlePoints)for(var n in e.vertices)e.vertices[n].attr.renderTime=t}else if(e instanceof b)s.polyline([e.a,e.b,e.c],!1,this.drawConfig.triangle.color,this.drawConfig.triangle.lineWidth),this.drawConfig.drawHandlePoints||(e.a.attr.renderTime=e.b.attr.renderTime=e.c.attr.renderTime=t);else if(e instanceof E)this.drawConfig.drawHandleLines&&(s.setCurrentId(`${e.uid}_e0`),s.setCurrentClassName(`${e.className}-v-line`),s.line(e.center.clone().add(0,e.signedRadiusV()).rotate(e.rotation,e.center),e.axis,"#c8c8c8"),s.setCurrentId(`${e.uid}_e1`),s.setCurrentClassName(`${e.className}-h-line`),s.line(e.center.clone().add(e.signedRadiusH(),0).rotate(e.rotation,e.center),e.axis,"#c8c8c8")),s.setCurrentId(e.uid),s.setCurrentClassName(`${e.className}`),s.ellipse(e.center,e.radiusH(),e.radiusV(),this.drawConfig.ellipse.color,this.drawConfig.ellipse.lineWidth,e.rotation),this.drawConfig.drawHandlePoints||(e.center.attr.renderTime=t,e.axis.attr.renderTime=t);else if(e instanceof N){s.setCurrentId(e.uid),s.setCurrentClassName(`${e.className}`);const t=N.ellipseSectorUtils.describeSVGArc(e.ellipse.center.x,e.ellipse.center.y,e.ellipse.radiusH(),e.ellipse.radiusV(),e.startAngle,e.endAngle,e.ellipse.rotation,{moveToStart:!0});s.path(t,this.drawConfig.ellipseSector.color,this.drawConfig.ellipseSector.lineWidth)}else e instanceof g?s.circle(e.center,e.radius,this.drawConfig.circle.color,this.drawConfig.circle.lineWidth):e instanceof v?s.circleArc(e.circle.center,e.circle.radius,e.startAngle,e.endAngle,this.drawConfig.circleSector.color,this.drawConfig.circleSector.lineWidth):e instanceof a?!this.drawConfig.drawVertices||e.attr.selectable&&e.attr.draggable||!e.attr.visible||(s.circleHandle(e,7,this.drawConfig.vertex.color),e.attr.renderTime=t):e instanceof f?(s.line(e.a,e.b,this.drawConfig.line.color,this.drawConfig.line.lineWidth),this.drawConfig.drawHandlePoints&&e.a.attr.selectable||(e.a.attr.renderTime=t),this.drawConfig.drawHandlePoints&&e.b.attr.selectable||(e.b.attr.renderTime=t)):e instanceof c?(s.arrow(e.a,e.b,this.drawConfig.vector.color),this.drawConfig.drawHandlePoints&&e.b.attr.selectable&&e.b.attr.visible?(s.setCurrentId(`${e.uid}_h0`),s.setCurrentClassName(`${e.className}-handle`),s.circleHandle(e.b,3,"#a8a8a8")):e.b.attr.renderTime=t,this.drawConfig.drawHandlePoints&&e.a.attr.selectable||(e.a.attr.renderTime=t),this.drawConfig.drawHandlePoints&&e.b.attr.selectable||(e.b.attr.renderTime=t)):e instanceof T?(this.drawConfig.drawHandleLines&&(s.setCurrentId(`${e.uid}_l0`),s.setCurrentClassName(`${e.className}-line`),s.line(e.upperLeft,e.lowerRight,this.drawConfig.image.color,this.drawConfig.image.lineWidth)),i.setCurrentId(e.uid),i.image(e.image,e.upperLeft,e.lowerRight.clone().sub(e.upperLeft)),this.drawConfig.drawHandlePoints&&(s.setCurrentId(`${e.uid}_h0`),s.setCurrentClassName(`${e.className}-lower-right`),s.circleHandle(e.lowerRight,3,this.drawConfig.image.color),e.lowerRight.attr.renderTime=t)):console.error("Cannot draw object. Unknown class.");s.setCurrentClassName(null),s.setCurrentId(null),i.setCurrentClassName(null),i.setCurrentId(null)}drawSelectPolygon(e){null!=this.selectPolygon&&this.selectPolygon.vertices.length>0&&(e.setCurrentId(this.selectPolygon.uid),e.polygon(this.selectPolygon,"#888888"),e.crosshair(this.selectPolygon.vertices[0],3,"#008888"))}drawVertices(e,t){for(var s in this.vertices)this.drawConfig.drawVertices&&this.vertices[s].attr.renderTime!=e&&this.vertices[s].attr.visible&&(t.setCurrentId(this.vertices[s].uid),t.squareHandle(this.vertices[s],5,this._handleColor(this.vertices[s],"rgb(0,128,192)")),this.vertices[s].attr.renderTime=e)}redraw(){const e=this.renderTime++;this.draw.beginDrawCycle(e),this.fill.beginDrawCycle(e),this.config.preClear&&this.config.preClear(),this.clear(),this.config.preDraw&&this.config.preDraw(this.draw,this.fill),this.drawAll(e,this.draw,this.fill),this.config.postDraw&&this.config.postDraw(this.draw,this.fill),this.draw.endDrawCycle(e),this.fill.endDrawCycle(e)}drawAll(e,t,s){this.drawGrid(t),this.config.drawOrigin&&this.drawOrigin(t),this.drawDrawables(e,t,s),this.drawVertices(e,t),this.drawSelectPolygon(t),t.setCurrentId(void 0),t.setCurrentClassName(void 0)}clear(){this.draw.clear(this.config.backgroundColor)}clearSelection(e){for(var t in this.vertices)this.vertices[t].attr.isSelected=!1;return e&&this.redraw(),this}viewport(){return new h(this.transformMousePosition(0,0),this.transformMousePosition(this.canvasSize.width*this.config.cssScaleX,this.canvasSize.height*this.config.cssScaleY))}saveFile(){this.hooks.saveFile(this)}getFProp(e,t){return parseFloat(globalThis.getComputedStyle(e,null).getPropertyValue(t))}getAvailableContainerSpace(){const e=this,t=e.canvas.parentNode;e.canvas.style.display="none";var s=this.getFProp(t,"padding")||0,i=this.getFProp(e.canvas,"border-width")||0,r=this.getFProp(t,"padding-left")||s,n=this.getFProp(t,"padding-right")||s,a=this.getFProp(t,"padding-top")||s,o=this.getFProp(t,"padding-bottom")||s,h=this.getFProp(e.canvas,"border-left-width")||i,l=this.getFProp(e.canvas,"border-right-width")||i,c=this.getFProp(e.canvas,"border-top-width")||i,u=this.getFProp(e.canvas,"border-bottom-width")||i,d=t.clientWidth,f=t.clientHeight;return e.canvas.style.display="block",{width:d-r-n-h-l,height:f-a-o-c-u}}resizeCanvas(){const e=this,t=(t,s)=>{t*=e.config.canvasWidthFactor,s*=e.config.canvasHeightFactor,e.canvasSize.width=t,e.canvasSize.height=s,e.canvas instanceof HTMLCanvasElement?(e.canvas.width=t,e.canvas.height=s):e.canvas instanceof SVGElement?(this.canvas.setAttribute("viewBox",`0 0 ${t} ${s}`),this.canvas.setAttribute("width",`${t}`),this.canvas.setAttribute("height",`${s}`),this.draw.setSize(e.canvasSize),this.eventCatcher.style.width=`${t}px`,this.eventCatcher.style.height=`${s}px`):console.error("Error: cannot resize canvas element because it seems neither be a HTMLCanvasElement nor an SVGElement."),e.config.autoAdjustOffset&&e.adjustOffset(!1)};if(e.config.fullSize&&!e.config.fitToParent){var s=globalThis.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,i=globalThis.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;e.canvas.style.position="absolute",e.canvas.style.width=e.config.canvasWidthFactor*s+"px",e.canvas.style.height=e.config.canvasWidthFactor*i+"px",e.canvas.style.top="0px",e.canvas.style.left="0px",t(s,i)}else if(e.config.fitToParent){e.canvas.style.position="absolute";const s=this.getAvailableContainerSpace();e.canvas.style.width=e.config.canvasWidthFactor*s.width+"px",e.canvas.style.height=e.config.canvasHeightFactor*s.height+"px",e.canvas.style.top=null,e.canvas.style.left=null,t(s.width,s.height)}else e.canvas.style.width=null,e.canvas.style.height=null,t(e.config.defaultCanvasWidth,e.config.defaultCanvasHeight);e.config.redrawOnResize&&e.redraw()}selectVerticesInPolygon(e){for(var t in this.vertices)this.vertices[t].attr.selectable&&e.containsVert(this.vertices[t])&&(this.vertices[t].attr.isSelected=!0)}locatePointNear(e,t){const s=this;void 0===t&&(t=7),t/=s.draw.scale.x;for(var i=0;i<s.vertices.length;i++){var r=s.vertices[i];if((r.attr.draggable||r.attr.selectable)&&r.distance(e)<t)return new L.Draggable(r,L.Draggable.VERTEX).setVIndex(i)}return null}handleClick(e){const t=this;var s=this.locatePointNear(t.transformMousePosition(e.params.pos.x,e.params.pos.y),L.DEFAULT_CLICK_TOLERANCE/Math.min(t.config.cssScaleX,t.config.cssScaleY));if(s)if(t.vertices[s.vindex].listeners.fireClickEvent(e),this.keyHandler&&this.keyHandler.isDown("shift")){if("bpath"==s.typeName){let e=t.paths[s.pindex].bezierCurves[s.cindex].getPointByID(s.pid);e.attr.selectable&&(e.attr.isSelected=!e.attr.isSelected)}else if("vertex"==s.typeName){let e=t.vertices[s.vindex];e.attr.selectable&&(e.attr.isSelected=!e.attr.isSelected)}t.redraw()}else this.keyHandler.isDown("y")&&(t.vertices[s.vindex].attr.bezierAutoAdjust=!t.vertices[s.vindex].attr.bezierAutoAdjust,t.redraw());else if(null!=t.selectPolygon){const s=t.transformMousePosition(e.params.pos.x,e.params.pos.y);t.selectPolygon.vertices.push(new a(s.x,s.y)),t.redraw()}}transformMousePosition(e,t){return{x:(e/this.config.cssScaleX-this.config.offsetX)/this.config.scaleX,y:(t/this.config.cssScaleY-this.config.offsetY)/this.config.scaleY}}revertMousePosition(e,t){return{x:e/this.config.cssScaleX+this.config.offsetX,y:t/this.config.cssScaleY+this.config.offsetY}}getDraggedElementCount(){return this.draggedElements.length}mouseDownHandler(e){const t=this;if(0==e.button){var s=t.locatePointNear(t.transformMousePosition(e.params.pos.x,e.params.pos.y),L.DEFAULT_CLICK_TOLERANCE/Math.min(t.config.cssScaleX,t.config.cssScaleY));if(s){if("vertex"==s.typeName&&t.vertices[s.vindex].attr.isSelected)for(var i=0;i<t.vertices.length;i++)t.vertices[i].attr.isSelected&&(t.draggedElements.push(new L.Draggable(t.vertices[i],L.Draggable.VERTEX).setVIndex(i)),t.vertices[i].listeners.fireDragStartEvent(e));else{if(!t.vertices[s.vindex].attr.draggable)return;t.draggedElements.push(s),"bpath"==s.typeName?t.paths[s.pindex].bezierCurves[s.cindex].getPointByID(s.pid).listeners.fireDragStartEvent(e):"vertex"==s.typeName&&t.vertices[s.vindex].listeners.fireDragStartEvent(e)}t.redraw()}}}mouseDragHandler(e){const t=this,s={x:e.params.dragAmount.x,y:e.params.dragAmount.y};if(e.params.dragAmount.x/=t.config.cssScaleX,e.params.dragAmount.y/=t.config.cssScaleY,this.keyHandler.isDown("alt")||this.keyHandler.isDown("spacebar"))t.setOffset(t.draw.offset.clone().add(e.params.dragAmount)),t.redraw();else for(var i in e.params.dragAmount.x/=t.draw.scale.x,e.params.dragAmount.y/=t.draw.scale.y,t.draggedElements){var r=t.draggedElements[i];if("bpath"==r.typeName)t.paths[r.pindex].moveCurvePoint(r.cindex,r.pid,new a(e.params.dragAmount.x,e.params.dragAmount.y)),t.paths[r.pindex].bezierCurves[r.cindex].getPointByID(r.pid).listeners.fireDragEvent(e);else if("vertex"==r.typeName){if(!t.vertices[r.vindex].attr.draggable)continue;t.vertices[r.vindex].add(e.params.dragAmount),t.vertices[r.vindex].listeners.fireDragEvent(e)}}e.params.dragAmount.x=s.x,e.params.dragAmount.y=s.y,t.redraw()}mouseUpHandler(e){const t=this;if(0==e.button){for(var s in e.params.wasDragged||t.handleClick(e),t.draggedElements){var i=t.draggedElements[s];"bpath"==i.typeName?t.paths[i.pindex].bezierCurves[i.cindex].getPointByID(i.pid).listeners.fireDragEndEvent(e):"vertex"==i.typeName&&t.vertices[i.vindex].listeners.fireDragEndEvent(e)}t.draggedElements=[],t.redraw()}}mouseWheelHandler(e){var t=1.25;const s=this,i=e;i.deltaY<0?s.setZoom(s.config.scaleX*t,s.config.scaleY*t,new a(e.params.pos.x,e.params.pos.y)):i.deltaY>0&&s.setZoom(s.config.scaleX/t,s.config.scaleY/t,new a(e.params.pos.x,e.params.pos.y)),e.preventDefault(),s.redraw()}adjustOffset(e){this.draw.offset.x=this.fill.offset.x=this.config.offsetX=this.canvasSize.width*(this.config.offsetAdjustXPercent/100),this.draw.offset.y=this.fill.offset.y=this.config.offsetY=this.canvasSize.height*(this.config.offsetAdjustYPercent/100),e&&this.redraw()}setOffset(e){this.draw.offset.set(e),this.fill.offset.set(e),this.config.offsetX=e.x,this.config.offsetY=e.y}setZoom(e,t,s){let i=this.transformMousePosition(s.x,s.y);this.draw.scale.x=this.fill.scale.x=this.config.scaleX=Math.max(e,.01),this.draw.scale.y=this.fill.scale.y=this.config.scaleY=Math.max(t,.01);let r=this.transformMousePosition(s.x,s.y),n=this.draw.offset.x+(r.x-i.x)*this.draw.scale.x,a=this.draw.offset.y+(r.y-i.y)*this.draw.scale.y;this.setOffset({x:n,y:a})}installInputListeners(){var e=this;if(this.config.enableMouse?new A(this.eventCatcher?this.eventCatcher:this.canvas).down((t=>{e.mouseDownHandler(t)})).drag((t=>{e.mouseDragHandler(t)})).up((t=>{e.mouseUpHandler(t)})):e.console.log("Mouse interaction disabled."),this.config.enableMouseWheel?new A(this.eventCatcher?this.eventCatcher:this.canvas).wheel((t=>{e.mouseWheelHandler(t)})):e.console.log("Mouse wheel interaction disabled."),this.config.enableTouch){const n=t=>{const s=e.canvas.getBoundingClientRect();return{x:t.x-s.left,y:t.y-s.top}};if("function"==typeof globalThis.AlloyFinger||"function"==typeof globalThis.createAlloyFinger)try{var t=null,s=null,i=null,r=null;const o=()=>{t=null,s=null,i=null,r=null,e.draggedElements=[]},h={touchStart:r=>{if(1==r.touches.length&&(t=new a(n({x:r.touches[0].clientX,y:r.touches[0].clientY})),s=new a(n({x:r.touches[0].clientX,y:r.touches[0].clientY})),(i=e.locatePointNear(e.transformMousePosition(t.x,t.y),L.DEFAULT_TOUCH_TOLERANCE/Math.min(e.config.cssScaleX,e.config.cssScaleY)))&&"vertex"==i.typeName)){var o=e.vertices[i.vindex],h={params:{isTouchEvent:!0,dragAmount:{x:0,y:0},wasDragged:!1,mouseDownPos:s.clone(),mouseDragPos:s.clone(),vertex:o}};e.draggedElements=[i],o.listeners.fireDragStartEvent(h)}},touchMove:r=>{if(1==r.touches.length&&i){r.preventDefault(),r.stopPropagation();var o=n({x:r.touches[0].clientX,y:r.touches[0].clientY}),h=e.transformMousePosition(o.x,o.y),l=new a(e.transformMousePosition(t.x,t.y)).difference(h);if("vertex"==i.typeName){if(!e.vertices[i.vindex].attr.draggable)return;e.vertices[i.vindex].add(l);var c=e.vertices[i.vindex],u={isTouchEvent:!0,params:{dragAmount:l.clone(),wasDragged:!0,mouseDownPos:s.clone(),mouseDragPos:s.clone().add(l),vertex:c}};c.listeners.fireDragEvent(u),e.redraw()}t=new a(o)}else 2==r.touches.length&&(r.preventDefault(),r.stopPropagation(),e.setOffset(e.draw.offset.clone().addXY(r.deltaX,r.deltaY)),e.redraw())},touchEnd:r=>{if(i&&"vertex"==i.typeName){var n=e.vertices[i.vindex],a={isTouchEvent:!0,params:{dragAmount:{x:0,y:0},wasDragged:!1,mouseDownPos:s.clone(),mouseDragPos:s.clone(),vertex:n}};t&&s&&s.distance(t)<.001?n.listeners.fireClickEvent(a):n.listeners.fireDragEndEvent(a)}o()},touchCancel:e=>{o()},multipointStart:t=>{r=e.draw.scale.clone()},multipointEnd:e=>{r=null},pinch:t=>{const s=new a(t.touches.item(0).clientX,t.touches.item(0).clientY),i=new a(t.touches.item(1).clientX,t.touches.item(1).clientY),n=new f(s,i).vertAt(.5);e.setZoom(r.x*t.zoom,r.y*t.zoom,n),e.redraw()}};window.createAlloyFinger?window.createAlloyFinger(this.eventCatcher?this.eventCatcher:this.canvas,h):new M.Z(this.eventCatcher?this.eventCatcher:this.canvas,h)}catch(e){console.error("Failed to initialize AlloyFinger!"),console.error(e)}else globalThis.Touchy&&"function"==typeof globalThis.Touchy?console.error("[Deprecation] Found Touchy which is not supported any more. Please use AlloyFinger instead."):console.warn("Cannot initialize the touch handler. AlloyFinger is missig. Did you include it?")}else e.console.log("Touch interaction disabled.");this.config.enableKeys?this.keyHandler=new P({trackAll:!0}).down("escape",(function(){e.clearSelection(!0)})).down("shift",(function(){e.selectPolygon=new o,e.redraw()})).up("shift",(function(){null!=e.selectPolygon&&(e.selectVerticesInPolygon(e.selectPolygon),e.selectPolygon=null,e.redraw())})):e.console.log("Keyboard interaction disabled.")}createGUI(e){if(globalThis.utils&&"function"==typeof globalThis.utils.createGUI)return globalThis.utils.createGUI(this,e);throw"Cannot create dat.GUI instance; did you load the ./utils/creategui helper function an the dat.GUI library?"}}L.DEFAULT_CANVAS_WIDTH=1024,L.DEFAULT_CANVAS_HEIGHT=768,L.DEFAULT_CLICK_TOLERANCE=8,L.DEFAULT_TOUCH_TOLERANCE=32,L.Draggable=((I=class{constructor(e,t){this.item=e,this.typeName=t}isVertex(){return this.typeName==L.Draggable.VERTEX}setVIndex(e){return this.vindex=e,this}}).VERTEX="vertex",I),L.utils={safeMergeByKeys:(e,t)=>{for(var s in t)if(t.hasOwnProperty(s))if(e.hasOwnProperty(s)){var i=typeof e[s];try{"boolean"==i?e[s]=!!JSON.parse(t[s]):"number"==i?e[s]=1*JSON.parse(t[s]):("function"==i&&t[s],e[s]=t[s])}catch(e){console.error("error in key ",s,t[s],e)}}else e[s]=t[s];return e},setCSSscale:(e,t,s)=>{e.style["transform-origin"]="0 0",e.style.transform=1==t&&1==s?null:"scale("+t+","+s+")"},fetch:{val:(e,t,s)=>e.hasOwnProperty(t)?void 0===e[t]?s:e[t]:s,num:(e,t,s)=>{if(!e.hasOwnProperty(t))return s;if("number"==typeof e[t])return e[t];try{return 1*JSON.parse(e[t])}catch(e){return s}},bool:(e,t,s)=>{if(!e.hasOwnProperty(t))return s;if("boolean"==typeof e[t])return e[t];try{return!!JSON.parse(e[t])}catch(e){return s}},func:(e,t,s)=>e.hasOwnProperty(t)?"function"!=typeof e[t]?s:e[t]:s},enableBezierPathAutoAdjust:e=>{for(var t=0;t<e.bezierCurves.length;t++)e.bezierCurves[t].startPoint.listeners.addDragListener((function(t){var s=e.locateCurveByStartPoint(t.params.vertex);e.bezierCurves[s].startPoint.addXY(-t.params.dragAmount.x,-t.params.dragAmount.y),e.moveCurvePoint(1*s,e.START_POINT,t.params.dragAmount),e.updateArcLengths()})),e.bezierCurves[t].startControlPoint.listeners.addDragListener((function(t){var s=e.locateCurveByStartControlPoint(t.params.vertex);e.bezierCurves[s].startPoint.attr.bezierAutoAdjust&&(e.adjustPredecessorControlPoint(1*s,!0,!1),e.updateArcLengths())})),e.bezierCurves[t].endControlPoint.listeners.addDragListener((function(t){var s=e.locateCurveByEndControlPoint(t.params.vertex);e.bezierCurves[s%e.bezierCurves.length].endPoint.attr.bezierAutoAdjust&&(e.adjustSuccessorControlPoint(1*s,!0,!1),e.updateArcLengths())})),t+1==e.bezierCurves.length&&e.bezierCurves[e.bezierCurves.length-1].endPoint.listeners.addDragListener((function(t){if(!e.adjustCircular){var s=e.locateCurveByEndPoint(t.params.vertex);e.moveCurvePoint(1*s,e.END_CONTROL_POINT,new a({x:t.params.dragAmount.x,y:t.params.dragAmount.y}))}e.updateArcLengths()}))}};class z{constructor(){console.warn("THIS CLASS IS DEPRECATED. Please use the new 'drawutilssvg' instead.")}build(e,t){var s="\n",i=[];for(var r in i.push('<?xml version="1.0" encoding="UTF-8"?>\n'),i.push('<svg width="'+t.canvasSize.width+'" height="'+t.canvasSize.height+'"'),i.push(' viewBox="'),i.push("0"),i.push(" "),i.push("0"),i.push(" "),i.push(t.canvasSize.width.toString()),i.push(" "),i.push(t.canvasSize.height.toString()),i.push('"'),i.push(' xmlns="http://www.w3.org/2000/svg">\n'),i.push("  <defs>\n"),i.push("  <style>\n"),i.push("     .Vertex { fill : blue; stroke : none; } \n"),i.push("     .Triangle { fill : none; stroke : turquoise; stroke-width : 1px; } \n"),i.push("     .Polygon { fill : none; stroke : green; stroke-width : 2px; } \n"),i.push("     .BezierPath { fill : none; stroke : blue; stroke-width : 2px; } \n"),i.push("     .VEllipse { fill : none; stroke : black; stroke-width : 1px; } \n"),i.push("     .Line { fill : none; stroke : purple; stroke-width : 1px; } \n"),i.push("     .Circle { fill : none; stroke : purple; stroke-width : 1px; } \n"),i.push("     .CircleSector { fill : none; stroke : purple; stroke-width : 1px; } \n"),i.push("  </style>\n"),i.push("  </defs>\n"),i.push('  <g class="main-g"'),(t.zoom||t.offset)&&(i.push(' transform="'),t.zoom&&i.push("scale("+t.zoom.x+","+t.zoom.y+")"),t.offset&&i.push(" translate("+t.offset.x+","+t.offset.y+")"),i.push('"')),i.push(">\n"),e){var n=e[r];"function"==typeof n.toSVGString?(i.push("    "),i.push(n.toSVGString({className:n.className})),i.push(s)):console.warn("Unrecognized drawable type has no toSVGString()-function. Ignoring: "+n.className)}return i.push("  </g>\n"),i.push("</svg>\n"),i.join("")}}},586:(e,t,s)=>{s.r(t),s.d(t,{Red:()=>r,Pink:()=>n,Purple:()=>a,DeepPurple:()=>o,Indigo:()=>h,Blue:()=>l,LightBlue:()=>c,Cyan:()=>u,Teal:()=>d,Green:()=>f,LightGreen:()=>g,WebColors:()=>v,shuffleWebColors:()=>p});var i=s(482);const r=i.I.makeRGB(255,67,55),n=i.I.makeRGB(232,31,100),a=i.I.makeRGB(156,39,175),o=i.I.makeRGB(103,59,184),h=i.I.makeRGB(64,81,181),l=i.I.makeRGB(35,151,245),c=i.I.makeRGB(6,170,245),u=i.I.makeRGB(3,189,214),d=i.I.makeRGB(1,150,137),f=i.I.makeRGB(77,175,82),g=i.I.makeRGB(141,195,67),v=[r,n,a,o,h,l,c,u,d,f,g],p=e=>{const t=Array(e.length);for(var s=0;s<e.length;s++)t[s]=v[e[s]%v.length];return t}},858:(e,t,s)=>{s.r(t),s.d(t,{WebColorsContrast:()=>i});const i=(0,s(586).shuffleWebColors)([8,0,6,4,1,9,2,10,3,7,5])},566:(e,t,s)=>{s.r(t),s.d(t,{WebColorsMalachite:()=>r});var i=s(482);const r=[i.I.makeRGB(0,21,6),i.I.makeRGB(0,30,12),i.I.makeRGB(0,52,28),i.I.makeRGB(0,81,47),i.I.makeRGB(21,134,88),i.I.makeRGB(0,46,19),i.I.makeRGB(0,68,40),i.I.makeRGB(11,81,55),i.I.makeRGB(0,91,46),i.I.makeRGB(0,111,46),i.I.makeRGB(33,140,106)]},482:(e,t,s)=>{s.d(t,{I:()=>i});class i{constructor(){this.r=this.g=this.b=0,this.h=this.s=this.l=0,this.a=1}cssRGB(){return"rgb("+Math.round(255*this.r)+","+Math.round(255*this.g)+","+Math.round(255*this.b)+")"}cssRGBA(){return"rgba("+Math.round(255*this.r)+","+Math.round(255*this.g)+","+Math.round(255*this.b)+","+this.a+")"}red(){return this.r}green(){return this.g}blue(){return this.b}cssHSL(){return"hsl("+Math.round(360*this.h)+","+Math.round(100*this.s)+"%,"+Math.round(100*this.l)+"%)"}cssHSLA(){return"hsla("+Math.round(360*this.h)+","+Math.round(100*this.s)+"%,"+Math.round(100*this.l)+"%,"+Math.round(this.a)+")"}hue(){return this.h}saturation(){return this.s}lightness(){return this.l}cssHEX(){return"#"+(255*this.r<16?"0":"")+Math.round(255*this.r).toString(16)+(255*this.g<16?"0":"")+Math.round(255*this.g).toString(16)+(255*this.b<16?"0":"")+Math.round(255*this.b).toString(16)}alpha(){return this.a}saturate(e){if("string"==typeof e&&e.indexOf("%")>-1&&NaN!=(e=parseInt(e)))this.s+=e/100;else{if("number"!=typeof e)throw new Error("error: bad modifier format (percent or number)");this.s+=e/255}this.s>1?this.s=1:this.s<0&&(this.s=0),i.Converter.HSLToRGB(this)}desaturate(e){this.saturate("-"+e)}lighten(e){if("string"==typeof e&&e.indexOf("%")>-1&&NaN!=(e=parseInt(e)))this.l+=e/100;else{if("number"!=typeof e)throw new Error("error: bad modifier format (percent or number)");this.l+=e/255}this.l>1?this.l=1:this.l<0&&(this.l=0),i.Converter.HSLToRGB(this)}darken(e){this.lighten("-"+e)}fadein(e){if("string"==typeof e&&e.indexOf("%")>-1&&NaN!=(e=parseInt(e)))this.a+=e/100;else{if("number"!=typeof e)throw new Error("error: bad modifier format (percent or number)");this.a+=e/255}this.a>1?this.a=1:this.a<0&&(this.a=0),i.Converter.HSLToRGB(this)}fadeout(e){this.fadein("-"+e)}spin(e){if("string"==typeof e&&e.indexOf("%")>-1&&NaN!=(e=parseInt(e)))this.h+=e/100;else{if("number"!=typeof e)throw new Error("error: bad modifier format (percent or number)");this.h+=e/360}this.h>1?this.h=1:this.h<0&&(this.h=0),i.Converter.HSLToRGB(this)}static makeRGB(...e){const t=new i;let s;if(arguments.length<3||arguments.length>4)throw new Error("error: 3 or 4 arguments");return s=i.Sanitizer.RGB(arguments[0],arguments[1],arguments[2]),t.r=s[0],t.g=s[1],t.b=s[2],4==arguments.length&&(t.a=arguments[3]),i.Converter.RGBToHSL(t),t}static makeHSL(...e){const t=new i;let s;if(arguments.length<3||arguments.length>4)throw new Error("error: 3 or 4 arguments");return s=i.Sanitizer.HSL(arguments[0],arguments[1],arguments[2]),t.h=s[0],t.s=s[1],t.l=s[2],4==arguments.length&&(t.a=arguments[3]),i.Converter.HSLToRGB(t),t}static makeHEX(e){var t,s=new i;if(e&&e.startsWith("#")&&(e=e.substr(1)),i.Validator.checkHEX(e),3==e.length)t=i.Sanitizer.RGB(parseInt(e.substr(0,1)+e.substr(0,1),16),parseInt(e.substr(1,1)+e.substr(1,1),16),parseInt(e.substr(2,1)+e.substr(2,1),16));else{if(6!=e.length)throw new Error("error: 3 or 6 arguments");t=i.Sanitizer.RGB(parseInt(e.substr(0,2),16),parseInt(e.substr(2,2),16),parseInt(e.substr(4,2),16))}return s.r=t[0],s.g=t[1],s.b=t[2],i.Converter.RGBToHSL(s),s}static parse(e){if(void 0===e)return null;if(0==(e=e.trim().toLowerCase()).length)return null;if(e.startsWith("#"))return i.makeHEX(e.substring(1,e.length));if(e.startsWith("rgb")){var t=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(0\.\d+))?\)$/.exec(e);return void 0===t[4]?i.makeRGB(t[1],t[2],t[3]):i.makeRGB(t[1],t[2],t[3],t[4])}throw"Unrecognized color format: "+e}clone(){return i.makeRGB(this.r,this.g,this.b,this.a)}interpolate(e,t){return this.r+=(e.r-e.r)*t,this.g+=(e.g-e.g)*t,this.b+=(e.b-e.b)*t,this.a+=(e.a-e.a)*t,this}}i.Sanitizer={RGB:function(...e){var t=[];if(0==arguments.length)return[];for(var s=0;s<arguments.length;s++){var i=arguments[s];if("string"==typeof i&&i.indexOf("%")>-1){if(NaN==(i=parseInt(i)))throw new Error("Bad format");if(i<0||i>100)throw new Error("Bad format");t[s]=i/100}else{if("string"==typeof i&&NaN==(i=parseInt(i)))throw new Error("Bad format");if(i<0)throw new Error("Bad format");if(i>=0&&i<1)t[s]=i;else{if(!(i>=1&&i<256))throw new Error("Bad format ("+i+")");t[s]=i/255}}}return t},HSL:function(...e){if(arguments.length<3||arguments.length>4)throw new Error("3 or 4 arguments required");var t=arguments[0],s=arguments[1],i=arguments[2];if("string"==typeof t&&NaN==(t=parseFloat(t)))throw new Error("Bad format for hue");if(t<0||t>360)throw new Error("Hue out of range (0..360)");if(((""+t).indexOf(".")>-1&&t>1||-1==(""+t).indexOf("."))&&(t/=360),"string"==typeof s&&s.indexOf("%")>-1){if(NaN==(s=parseInt(s)))throw new Error("Bad format for saturation");if(s<0||s>100)throw new Error("Bad format for saturation");s/=100}else if(s<0||s>1)throw new Error("Bad format for saturation");if("string"==typeof i&&i.indexOf("%")>-1){if(NaN==(i=parseInt(i)))throw new Error("Bad format for lightness");if(i<0||i>100)throw new Error("Bad format for lightness");i/=100}else if(i<0||i>1)throw new Error("Bad format for lightness");return[t,s,i]}},i.Validator={checkHEX:e=>{if(6!=e.length&&3!=e.length)throw new Error("Hexa color: bad length ("+e.length+"),"+e);e=e.toLowerCase();for(var t=0;t<e.length;t++){var s=e.charCodeAt(t);if(!(s>=48&&s<=57||s>=97&&s<=102))throw new Error(`Hexa color: out of range for "${e}" at position ${t}.`)}}},i.Converter={RGBToHSL:e=>{var t=e.r,s=e.g,i=e.b,r=Math.max(t,s,i),n=Math.min(t,s,i);if(e.l=(r+n)/2,r==n)e.h=e.s=0;else{var a=r-n;switch(e.s=e.l>.5?a/(2-r-n):a/(r+n),r){case t:e.h=(s-i)/a+(s<i?6:0);break;case s:e.h=(i-t)/a+2;break;case i:e.h=(t-s)/a+4}e.h/=6}},HSLToRGB:e=>{var t=e.h,s=e.s,r=e.l;if(0==s)e.r=e.g=e.b=r;else{var n=r<.5?r*(1+s):r+s-r*s,a=2*r-n;e.r=i.Converter.hue2rgb(a,n,t+1/3),e.g=i.Converter.hue2rgb(a,n,t),e.b=i.Converter.hue2rgb(a,n,t-1/3)}},hue2rgb:(e,t,s)=>(s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e)}}},s={};function i(e){var r=s[e];if(void 0!==r)return r.exports;var n=s[e]={exports:{}};return t[e].call(n.exports,n,n.exports,i),n.exports}i.m=t,e=[],i.O=(t,s,r,n)=>{if(!s){var a=1/0;for(c=0;c<e.length;c++){for(var[s,r,n]=e[c],o=!0,h=0;h<s.length;h++)(!1&n||a>=n)&&Object.keys(i.O).every((e=>i.O[e](s[h])))?s.splice(h--,1):(o=!1,n<a&&(a=n));if(o){e.splice(c--,1);var l=r();void 0!==l&&(t=l)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[s,r,n]},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var r,n,[a,o,h]=s,l=0;if(a.some((t=>0!==e[t]))){for(r in o)i.o(o,r)&&(i.m[r]=o[r]);if(h)var c=h(i)}for(t&&t(s);l<a.length;l++)n=a[l],i.o(e,n)&&e[n]&&e[n][0](),e[a[l]]=0;return i.O(c)},s=self.webpackChunkngdg=self.webpackChunkngdg||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var r=i.O(void 0,[736],(()=>i(333)));r=i.O(r)})();
//# sourceMappingURL=ngdg-main.min.js.map